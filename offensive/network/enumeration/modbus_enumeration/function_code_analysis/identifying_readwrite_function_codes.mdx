---
title: Identifying Read/Write Function Codes in Modbus Networks
description: Learn to identify and analyze read/write function codes in Modbus protocols,
  enhancing security and reconnaissance techniques.
keywords:
- Modbus protocol
- function codes
- read write operations
- network traffic analysis
- enumeration techniques
- active reconnaissance
- cybersecurity
- industrial control systems
- network scanning
- packet analysis
---

## Understanding Modbus Protocol

The Modbus protocol is a widely used communication protocol in industrial control systems, allowing multiple devices to communicate over a network. It is a master-slave or client-server type communication protocol primarily used for connecting industrial electronic devices. Modbus typically uses serial communication lines, such as RS-232 or RS-485, but can also operate over TCP/IP networks.

In the context of Modbus, function codes are pivotal as they define the action to be taken by the server (slave). For instance, read and write operations on a Modbus server are performed using specific function codes. Understanding these is crucial for enumerating and identifying read/write operations on a network. The most relevant function codes for reading data include 0x03 (Read Holding Registers) and 0x04 (Read Input Registers), while for writing, common codes include 0x06 (Write Single Register) and 0x10 (Write Multiple Registers).

## Network Traffic Analysis

Network traffic analysis involves capturing the data being transmitted over a network to understand the activities and operations occurring on it. Tools like Wireshark are instrumental in this process, allowing analysts to observe live traffic and static file analysis. When focusing on Modbus, capturing network packets helps identify specific communication patterns and the function codes used.

To capture Modbus traffic, filter traffic on the standard Modbus TCP port (502), or set filters for Modbus-specific traffic if using other transport methods. Researching the traffic can highlight various function codes in use. For example, by examining the content of the TCP frames, one can pinpoint which registers are being read or written by correlating Modbus Application Data Unit (ADU) packets with known structure templates.

## Function Code Enumeration

Function code enumeration involves sequencing through possible codes to determine which ones are active and supported by a networked device. This is accomplished by sending requests to a Modbus server sequentially using potential function codes for reading and writing, and observing the server responses.

Commonly used function codes for read operations are 0x03 and 0x04. These can be sent sequentially to the server to determine support. Similarly, for write operations, function codes like 0x06 and 0x10 can be employed. Using scripting languages such as Python in combination with libraries like PyModbus, one can automate this enumeration by checking for exceptions or valid responses indicating function code support.

```python
from pymodbus.client.sync import ModbusTcpClient

client = ModbusTcpClient('192.168.1.10')

# Example of reading holding registers
response = client.read_holding_registers(0, 10, unit=1)
if response.isError():
    print("Failed to read holding registers")
else:
    print("Holding registers read successfully:", response.registers)

# Example of writing a single register
response = client.write_register(1, 12345, unit=1)
if response.isError():
    print("Failed to write to register")
else:
    print("Register written successfully")

client.close()
```

## Active Reconnaissance Techniques

Active reconnaissance entails interacting directly with Modbus devices to deduce their supported capabilities and configurations. This could involve sending crafted requests purposely designed to elicit informative responses about the function codes the devices handle. Utilizing tools like Nmap with specific Modbus scripts can provide insights into available functions.

Running active reconnaissance scripts assists in determining the range of supported read/write operations, painting a clearer picture of the device's operational landscape. Actions during this stage should be ethically justified and authorized to prevent causing disruption or data compromise on operational networks.

## Bypassing Function Code Filters

Some Modbus configurations implement filters to restrict or allow only specific function codes, aiming to protect against unauthorized operations. Understanding how these filters are structured and how they respond to various inputs allows for the identification of any potential loopholes.

Techniques that system headers observe or malicious actors could explore include sending function codes intertwined with wrapped or obfuscated parameters that might inadvertently pass through filters due to configuration errors. Advanced knowledge of packet crafting tools like Scapy can enable creation of packets designed to slip through such filters by mimicking or tweaking legitimate communication attributes, testing device responses under different conditions.

## Exploiting Weak Configurations

Weak configuration surfaces occur when less secure or default settings in Modbus setups allow function codes to be exposed inadvertently. Identifying these weaknesses involves scanning for unsecured endpoints, default credentials, or predictable response patterns that reveal more about available functions than intended.

Exploitation might entail manipulating discovered write function codes in insecure setups to alter device states, generate unauthorized command executions, or convert improper error handling into information leaks. Leveraging known vulnerabilities in firmware or device logic to draw out unintended responses from read/write function operations might additionally expose systemic weaknesses.

## Automating Enumeration with Tools

Automation using offensive security frameworks consolidates the enumeration tasks into repeatable and efficient routines. Tools like Metasploit can integrate function code enumeration scripts into larger workflows, performing rapid assessments across wide network stretches.

Custom scripts or modules can be developed to automatically detect, log, and potentially exploit supported read/write function codes. By scripting with Python or using advanced tools like CyberChef, professionals can streamline Modbus enumeration efforts, allowing for continuous monitoring or scheduled reconnaissance sessions to maintain ongoing security awareness and posture improvements.