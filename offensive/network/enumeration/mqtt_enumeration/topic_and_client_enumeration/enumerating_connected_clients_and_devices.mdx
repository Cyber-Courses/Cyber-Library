---
title: Enumerating Connected Clients and Devices in MQTT
description: Learn how to enumerate connected clients and devices using MQTT protocols,
  tools, and techniques for effective network reconnaissance.
keywords:
- MQTT enumeration
- connected clients
- network reconnaissance
- client identification
- packet sniffing
- authenticity exploitation
- traffic analysis
- vulnerability exploitation
- lateral movement
- network discovery
---

### Enumerating Connected Clients and Devices

#### Leveraging MQTT Protocol Analysis Tools

MQTT protocol analysis tools are crucial for identifying connected clients and devices within a network employing this protocol. Tools such as MQTT Explorer and Wireshark, when configured appropriately, allow an attacker to monitor MQTT traffic and gain detailed insights into the broker's operation.

**MQTT Broker Inspection**: To initiate, connect to the broker using tools like MQTT Explorer that support both MQTT 3.1.1 and MQTT 5.0. Analyze details such as connected session counts and active client identifiers. This method requires access to the broker, which could be potentially sidestepped by exploiting public brokers or those with weak security configurations.

**MQTT Packet Sniffing**: Tools like Wireshark can capture packets on the network, with filters set to `mqtt`. Sniffing can reveal PUBLISH messages, often containing Client IDs or topics that identify connected clients and devices directly.

Wireshark Command Example:
```shell
# Start capturing MQTT packets on a specified network interface
tshark -i <interface> -f "tcp port 1883" -Y mqtt
```

#### Exploiting Weak Authentication Mechanisms

Weak authentication mechanisms present opportunities to enumerate clients by bypassing security controls that restrict access to client lists.

**Brute Force Credentials**: Tools such as Hydra can automate the guessing of MQTT login credentials using a dictionary attack. Once access is gained, the broker interface often provides lists of connected clients and further interaction details.

Hydra Command Example:
```shell
# Attempt dictionary attack against MQTT broker authentication
hydra -L user.txt -P pass.txt -s 1883 -e ns mqtt-broker.mydomain.com mqtt-v3
```

**Session Hijacking**: Poor session management on brokers may allow session hijacking. Capturing session tokens or cookies through man-in-the-middle (MITM) attacks can enable the attacker to impersonate an authorized client and enumerate connected devices.

#### Passive Data Gathering Techniques

Passive techniques focus on observing and collecting data without actively interacting with the network components, thus remaining undetected.

**Traffic Analysis**: Network monitoring tools like SolarWinds and Nagios can be used to observe MQTT message flow patterns, indirectly identifying active MQTT clients based on frequent interactions.

**Side Channel Observations**: By analyzing external factors such as device communication timing or volume, one can infer device presence and activity patterns. For instance, a regular burst of messages might indicate a specific client’s operational routine.

#### Active Probing Approaches

Active probing involves directly interacting with the MQTT network to solicit responses that reveal connected clients.

**Ping Sweeping**: Utilize tools like Nmap to perform a ping sweep over the network, identifying active devices that might correspond to MQTT clients.

Nmap Command Example:
```shell
# Perform a ping sweep to discover active IPs in the subnet
nmap -sn 192.168.1.0/24
```

**Broker API Calls**: Some brokers expose APIs that list connected clients. By exploiting these APIs through direct queries or using tools like Postman, one can retrieve a complete list of devices and their activities.

#### Discovery Through Subscriptions and Publishing

Interacting with the MQTT topics intelligently can yield information on connected clients.

**Wildcards in Topic Subscriptions**: By subscribing to topics using wildcards (e.g., `#` for all topics), attackers can capture messages intended for multiple clients, thus deducing client IDs and operational states.

**Probe Publishing**: Intentionally sending malformed or curious messages can provoke responses from connected clients or cause them to reveal information in error messages. This technique can be automated using scripts with tools such as mosquitto_pub.

#### Leveraging Known Broker Vulnerabilities

Exploiting known vulnerabilities in MQTT brokers can significantly streamline the client enumeration process.

**Version-based Exploitation**: Identifying the broker version using tools like nmap with service/version scanning features allows testing against a CVE database to find known vulnerabilities that may expose client lists.

Nmap Command Example:
```shell
# Scan broker with service and version detection
nmap -sV -p1883 mqtt-broker.mydomain.com
```

**MQTT Protocol Misconfigurations**: Misconfigured brokers may allow unrestricted topic access or unintended bridging to other networks, which can be exploited to gain access to otherwise restricted client lists.

#### Elevating Access Via Lateral Movement

By moving laterally within a compromised network, attackers can enhance their permissions and access broader client enumeration capabilities.

**Escalate Privileges on Broker**: Exploiting privilege escalations within the broker’s software or mismanagement of user roles can allow attackers administrative access to obtain direct and full user lists.

**Chain with Other Network Exploits**: Combine MQTT-specific attacks with other network vulnerabilities, such as exploiting a network service running alongside the MQTT broker, to create a pivot point for accessing connected clients.