---
title: Predicting Weak Pseudo Random Number Generators
description: Learn how attackers exploit weak PRNGs to predict object identifiers
  & perform IDOR attacks.
keywords:
- weak PRNG
- insecure direct object reference
- UUIDv1 prediction
- MongoDB ObjectID
- pseudo-random number generator
- LCG prediction
- Mersenne Twister attack
- predictable ID attack
- PRNG vulnerabilities
- timestamp-based IDs
---

# Weak Pseudo Random Number Generator

## Context

The objective of this article is to demonstrate how attackers can exploit weak pseudo-random number generators (PRNGs) to predict object identifiers and perform Insecure Direct Object References (IDOR) attacks in web applications. This requires a solid understanding of pseudo-random number generators, the structure of UUIDs, MongoDB object identifiers, and the mechanics of IDOR attacks.

## Theory

### Predictability in Weak PRNGs

Weak PRNGs generate sequences that appear random but can be predicted if the algorithm or seed is known. Predictable PRNG output undermines the secrecy of identifiers, enabling enumeration or targeted access. This is crucial because identifiers generated by weak PRNGs, such as timestamp-based IDs, Linear Congruential Generators (LCG), and Mersenne Twister, can be reconstructed by attackers. This predictability opens up vulnerabilities where secure ID generation is essential.

### Common Weak PRNG Implementations in Web Applications

Some common implementations where weak PRNGs are used include UUID Version 1 (UUIDv1) and MongoDB ObjectIDs. Both embed timestamps, making them partially predictable. Moreover, the use of LCG and Mersenne Twister in generating security-critical IDs exposes applications to prediction attacks. The general attack sequence involves an attacker observing one or more IDs, deducing the PRNG state, and then predicting future or past IDs.

### Security Implications of Predictable IDs

Predictable IDs facilitate unauthorized access to objects, effectively bypassing access controls and enabling IDOR attacks. An attacker can craft resource requests using predicted IDs to access or manipulate resources unlawfully.

## Practice

### Predicting Timestamp-Based Object IDs (e.g., MongoDB ObjectID)

- Observe a valid ObjectID from the application. ObjectIDs contain a 4-byte epoch timestamp at the start.
- Use the below command to obtain the current epoch time in hexadecimal to match the ObjectID prefix:

  ```bash
  python3 -c "import time,struct; print(hex(int(time.time())))"
  ```

- Increment or decrement the timestamp to generate nearby ObjectIDs. This allows prediction of IDs created shortly before or after the observed one.
- Generate a range of plausible timestamps with the following script:

  ```bash
  for i in range(-5,6): print(hex(int(time.time())+i))
  ```

- Combine the predicted timestamp with random bytes to form complete ObjectIDs, either by brute-forcing or guessing the remaining bytes.
- Use the predicted ObjectID to make a request:

  ```http
  GET /api/resource/5f1d7f3e0000000000000000
  ```

By successfully predicting ObjectIDs, an attacker can access objects not intended for them, bypassing authentication controls.

### UUIDv1 Prediction Attack

- Capture a UUIDv1 value from application output since it encodes a timestamp and a MAC address.
- Extract the timestamp from UUIDv1 using the following command:

  ```bash
  uuid_str = 'f47ac10b-58cc-11cf-a447-001451c1e001'; import uuid; u = uuid.UUID(uuid_str); print(u.time)
  ```

- Increment or decrement the timestamp to generate adjacent UUIDv1 values.
- Use the predicted UUIDv1 in a request:

  ```http
  GET /api/resource/f47ac10b-58cc-11cf-a447-001451c1e002
  ```

This attack method bypasses access control, granting unauthorized access to resources by predicting UUIDv1 identifiers.

### LCG/Mersenne Twister PRNG ID Prediction

- Collect a sequence of issued IDs from the application since multiple samples are needed to reconstruct the PRNG state.
- Use a script to predict the next ID based on the Mersenne Twister algorithm:

  ```python
  # Example: Predicting Mersenne Twister output
  from mt19937predictor import MT19937Predictor
  predictor = MT19937Predictor()
  for id in observed_ids:
      predictor.setrand32(id)
  next_id = predictor.predict_getrand32()
  ```

- Access the resource using the predicted PRNG-based ID:

  ```http
  GET /api/resource/<predicted_id>
  ```

By predicting the IDs generated by these PRNGs, attackers can bypass authentication controls and gain unauthorized access to system resources.

## Tools

- **Python**
- **mt19937predictor**