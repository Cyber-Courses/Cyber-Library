---
title: Exploiting PostgreSQL CAST for SQL Injection
description: Learn to exploit PostgreSQL's CAST function for error-based SQL injection
  attacks and extract sensitive data.
keywords:
- PostgreSQL
- CAST function
- SQL injection
- error-based
- type casting
- database security
- information disclosure
---

# PostgreSQL CAST

## Context

The purpose of this article is to teach how to exploit the PostgreSQL CAST function for error-based SQL injection attacks. It assumes that the reader has knowledge of SQL syntax, type casting, error handling, and is familiar with PostgreSQL Error-Based SQL injection techniques. Our focus will be on leveraging the CAST function to disclose sensitive information by exploiting improperly handled database errors.

## Theory

### Type Casting in PostgreSQL

Type casting is the conversion of a value from one data type to another. In PostgreSQL, this is typically done using the `CAST` function. The syntax generally follows the pattern: `CAST(value AS target_type)`. When PostgreSQL does not handle the conversion properly, it can result in errors that may reveal information about the database structure. Hence, an improperly handled CAST function can be a vector for error-based SQL injection.

### Error-Based SQL Injection

Error-based SQL injection is a technique used to extract data from a database by intentionally causing errors. Attackers craft specific payloads that provoke database errors, which can inadvertently expose valuable information contained within the errors themselves. The process often involves injecting SQL commands that the database cannot process, thereby causing it to generate detailed error responses.

### Exploiting PostgreSQL Errors

PostgreSQL errors can disclose sensitive information if they are not fully caught or sanitized. Crafting specific CAST expressions is one method attackers use to induce errors. For instance, attempting to cast textual data as an integer typically results in a conversion error, and the resulting error message can be leveraged to gain insights about the database schema or its content.

### Understanding PostgreSQL Data Types

PostgreSQL supports a wide range of data types, including basic types like integer, text, and boolean, as well as more advanced ones. Understanding these data types is crucial for crafting efficient CAST payloads that trigger informative errors. The knowledge of what data type conversions generally fail can help an attacker design more effective injection queries.

## Practice

### Exploiting PostgreSQL CAST for Error-Based SQL Injection

To exploit the PostgreSQL CAST function, an attacker might manually execute SQL commands that trigger conversion errors:

- Execute a command that will fail due to type mismatch:
    ```bash
    SELECT CAST('a' AS INTEGER);
    ```
    This command will attempt to cast the character `'a'` to an integer, resulting in a conversion error.

- Use a division by zero to test error handling:
    ```bash
    SELECT 1/0;
    ```
    This command purposely divides by zero, a known error condition, to observe the error messages returned.

- Craft a query that attempts to cast a table name as an integer:
    ```bash
    SELECT CAST((SELECT table_name FROM information_schema.tables LIMIT 1) AS INTEGER);
    ```
    Here, the query attempts to cast a table name to an integer, which will fail and potentially reveal errors containing important schema information.

Expected outcome: By using these methods, an attacker may extract database schema information from error messages.

### Automating Error-Based SQL Injection with CAST

Automation can drastically improve the efficiency of SQL injection attempts. Tools such as **sqlmap** can be employed to automate error-based SQL injection using the CAST function:

- Run sqlmap with specific flags to target PostgreSQL and test for error-based injection automatically:
    ```bash
    sqlmap -u 'http://example.com/page?id=1' --dbms=postgresql --technique=E --level=5 --risk=3
    ```
    This command instructs `sqlmap` to attempt error-based SQL injection on a given URL, targeting a PostgreSQL database, and using a high level and risk setting to attempt more aggressive payloads.

Expected outcome: Automated extraction of database information is achieved efficiently, potentially revealing sensitive data through error messages without manual intervention.

## Tools

- **sqlmap**: A powerful tool commonly used for automated testing of SQL injection vulnerabilities within web applications. It supports a wide range of SQL injection techniques and databases, including PostgreSQL, and can greatly expedite the task of exploiting vulnerabilities through automation.