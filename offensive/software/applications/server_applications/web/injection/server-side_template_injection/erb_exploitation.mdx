---
title: 'ERB Exploitation: Command Execution and File Access'
description: Explore ERB exploitation techniques for command execution and file access
  in Ruby/Rails applications through SSTI vulnerabilities.
keywords:
- ERB exploitation
- server-side template injection
- SSTI
- command execution
- file access
- Ruby on Rails
- ERB injection
- security vulnerabilities
---

# ERB Exploitation

## Context

The objective of ERB exploitation is to enable offensive operators to manipulate ERB-based server-side template injection (SSTI) vulnerabilities to execute arbitrary commands and access sensitive files in Ruby/Rails applications. Assumed knowledge includes understanding general template engine concepts, Ruby syntax and the object model, basic workings of the Ruby on Rails framework, and fundamentals of Server-Side Template Injection (SSTI). 

## Theory

### ERB Template Engine in Ruby/Rails

ERB (Embedded Ruby) is a powerful Ruby templating engine that processes templates containing Ruby code. This code is encapsulated using `<%= %>` for evaluating and outputting, or `<% %>` for execution without direct output. Templates evaluated with ERB execute within the Ruby interpreter's context and hold its privileges, potentially leading to high-impact security vulnerabilities if user inputs are not properly sanitized.

Vulnerabilities emerge when untrusted user inputs are directly embedded into these templates and executed, providing a firm basis for ERB exploitation.

### Attack Surface in ERB SSTI

The attack surface for ERB injection is wide, primarily because the Ruby code injected by attackers through user input is executed unchecked within the template context. Applications can be compromised due to a misplaced trust assumption that templates are safe, leading to improper sanitization processes for user inputs before evaluation, thus opening them to these attacks. 

### Exploitation Primitives in ERB

Exploiting ERB involves leveraging certain Ruby primitives that facilitate command execution and file reading. Ruby expressions encapsulated in `<%= %>` will be evaluated and output immediately, while code inside `<% %>` is executed without explicit output. Key primitives for exploitation include using `system()`, backticks (``), and `%x{}` to execute operating system commands, alongside `File.read` and other IO operations for file disclosure.

## Practice

### Detecting ERB Injection Points

To identify ERB injection points, one simple method is to inject a harmless Ruby expression to confirm the vulnerability:

- **Inject**: `<%= 7 * 7 %>`
- **Observe Response**: If you see '49' in the HTTP response, ERB injection is likely present, confirming a vulnerability and a possible vector for further exploitation.

### Command Execution via ERB Injection

After confirming an injection point, you can exploit it to execute arbitrary system commands. Here’s how:

- **Payload with Backticks**: `<%= `id` %>` — Executes the system 'id' command, displaying user information in the HTTP response.
- **Payload with System Function**: `<%= system('whoami') %>` — As an alternative, this executes 'whoami', another command to gather system user details.

Observe the command outputs in the application's HTTP response, exploiting the SSTI for achieving arbitrary OS command execution within the Ruby process's security context.

### File Read via ERB Injection

You can also exploit the ERB vulnerability to access sensitive files:

- **Payload**: `<%= File.read('/etc/passwd') %>` — Reads and outputs the contents of the `/etc/passwd` file, usually containing user account information.

The returned HTTP response will include this sensitive data, confirming file read capability through the injection point.

### Rails-Specific ERB SSTI Exploitation

Rails applications bring additional opportunities for SSTI exploitation specific to their framework:

- **Access Rails Root**: `<%= Rails.root %>` — Leaks the application root directory path.
- **Disclose Rails Secrets**: `<%= Rails.application.secrets %>` — Attempts to reveal Rails application secrets, critically impacting the application's confidentiality.

These exploitation steps can uncover significant sensitive data from the application's environment in the context of an ERB injection.

## Tools

- **curl**
- **Burp Suite** 