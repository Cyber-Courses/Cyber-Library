---
title: 'Thymeleaf Exploitation: A Guide to Securing Spring Boot'
description: Discover how to exploit and secure Thymeleaf in Spring Boot applications
  with practical tips on injection, file access, and command execution.
keywords:
- Thymeleaf injection
- Spring Boot security
- template engine exploitation
- server-side template injection
- remote code execution
- Thymeleaf vulnerabilities
- expression language injection
- file access via Thymeleaf
- Java-based template engine
- Spring Boot vulnerability
---

# Thymeleaf Exploitation

## Context

This article aims to guide offensive operators in exploiting Thymeleaf template injection vulnerabilities in Spring Boot web applications. Readers should have an understanding of template engines, expression languages, the HTTP request-response cycle, and Server-Side Template Injection (SSTI).

## Theory

### Thymeleaf Template Engine Mechanics

Thymeleaf is a popular Java-based server-side template engine typically used in Spring Boot applications. The engine processes data from user input within template expressions such as `th:text`, rendering these templates on the server before the response is returned to clients. A vulnerability arises when untrusted user input is processed as a Thymeleaf expression, opening the door to code execution controlled by an attacker.

### Expression Language Injection in Thymeleaf

Thymeleaf expressions are capable of interacting with Java objects and methods through expressions like `${...}` and `*{...}`. If these expressions are not adequately sandboxed, they can be abused to perform code execution within the application's environment. An attacker can inject a malicious expression into a template context, leading to arbitrary execution of code or unauthorized access to sensitive data. A common assumption by developers is that user input is safe for use in templates, making applications vulnerable to such injections.

### Threat Surface in Spring Boot Thymeleaf Applications

In a typical Spring Boot Thymeleaf application, user input may find its way into template variables that are rendered without adequate sanitization, forming a critical part of the threat surface. This is particularly prevalent when user-controllable data is rendered within Thymeleaf expression contexts, providing a gateway for potential exploitation.

## Practice

### Detecting Thymeleaf Injection Points

- **Identify injection points:** Begin by identifying fields where user input is reflected in rendered templates. Areas to scrutinize include profile pages and search results where attributes like `th:text` or `th:utext` are utilized.
  
- **Inject payload:** Test the evaluation by injecting a simple arithmetic expression:
  
  ```plaintext
  ${7*7}
  ```

- **Evaluate output:** Verify if the application output predominantly displays "49" instead of the submitted expression. The evaluation of this expression indicates a potential Thymeleaf injection point.

### Reading Arbitrary Files via Thymeleaf Injection

- **Craft file-reading payload:** Use a payload to attempt reading sensitive files, such as:

  ```plaintext
  ${T(java.nio.file.Files).readAllBytes(T(java.nio.file.Paths).get('/etc/passwd'))}
  ```

- **Submit payload:** Inject this payload into the vulnerable field and assess the rendered output for the file's content.

- **Outcome:** If successful, the contents of the target file, such as `/etc/passwd`, will be displayed, confirming access to files on the server.

### Remote Code Execution via Thymeleaf Injection

- **Execute command via payload:** Attempt to execute system commands with the following payload:

  ```plaintext
  ${T(java.lang.Runtime).getRuntime().exec('id')}
  ```

- **Validate execution:** Analyze the applicationâ€™s output for signs of command execution results. If direct results are suppressed, consider redirecting output to an accessible file or output method like `out.println`.

- **Outcome:** Successful command execution indicates remote code execution capability via Thymeleaf template injection.

## Tools

- **Burp Suite**
- **curl**