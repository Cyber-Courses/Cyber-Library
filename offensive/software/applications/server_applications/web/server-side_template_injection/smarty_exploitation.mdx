---
title: 'Smarty Exploitation: Techniques & Security Risks'
description: Explore Smarty template engine vulnerabilities. Learn exploitation techniques
  for command execution & file inclusion.
keywords:
- Smarty template engine
- PHP Smarty injection
- remote code execution
- file inclusion
- security risks
- Smarty payloads
- SSTI
---

# Smarty Exploitation

## Context

This article focuses on exploiting vulnerabilities in PHP applications using the Smarty template engine. The primary objective is to empower offensive operators to execute remote code or include files through Smarty template injection. It assumes familiarity with template engines, PHP syntax, server-side execution, and Server-Side Template Injection (SSTI).

## Theory

### Smarty Template Engine Internals

Smarty is a widely used PHP template engine that enables developers to separate application logic from presentation. Templates in Smarty can include logic and variable interpolation, making them susceptible to certain types of vulnerabilities.

At its core, Smarty allows embedding PHP code directly within templates using `{php}{/php}` tags. However, if these tags are not disabled, they can present significant security risks. Vulnerabilities arise when user input is rendered in templates without proper sanitization, potentially leading to code execution.

### Smarty Injection Attack Surface

Attackers can exploit the Smarty template engine by injecting malicious Smarty syntax into user-controlled inputs. These are inputs that get rendered by the template engine, allowing the injection to be executed on the server-side. A common trust assumption among developers is that the template context is inherently safe, leading to potential oversights.

Smarty inherently exposes functions and the ability to execute PHP code via template tags, making it a fertile ground for exploitation if safeguards are not in place.

### Smarty Payload Mechanics

Smarty payloads typically involve using Smarty tags to access PHP functions or include files. The aim is to trigger unintended behavior such as remote code execution or unauthorized file access. Attackers often employ filter bypass techniques using alternate tag syntax or function chaining to overcome weak input filters and execute their payloads.

## Practice

### Smarty PHP Tag Remote Code Execution

To achieve remote code execution using Smarty template injection, an attacker can utilize the `{php}{/php}` tags, assuming they are enabled.

- **Payload:**

  ```php
  {php}system('id');{/php}
  ```

  This payload attempts direct PHP code execution. If the `{php}` tag functionality is available, it allows execution of the `system` function to display the current user context.

- **Steps:**
  - Find a user-controllable input that is reflected in the template output.
  - Submit the payload within this input field and observe the response.

  The expected outcome is the execution of arbitrary operating system commands as the server user.

### Smarty Function Injection for Command Execution

Another method involves directly invoking PHP functions through the template.

- **Payload:**

  ```php
  {system('id')}
  ```

  This payload directly calls the `system` function through Smarty if not restricted by configuration.

- **Steps:**
  - Inject the payload into a variable or field processed by Smarty.
  - Verify if function invocation is successful in the template context.

  Successful execution will return the command output within the rendered page.

### Smarty File Inclusion via Template Injection

Attackers can attempt to read sensitive files by leveraging Smarty's include capabilities.

- **Payload:**

  ```php
  {include file='/etc/passwd'}
  ```

  This payload includes the contents of a sensitive file on the server.

- **Steps:**
  - Inject the payload into a field processed by the Smarty template.
  - Observe the response for the inclusion of file contents.

  The outcome is the disclosure of arbitrary file contents via template rendering.

### Bypassing Input Filters in Smarty Injection

For environments with basic input filtering, attackers can use variable indirection to bypass restrictions.

- **Payload:**

  ```php
  {assign var='x' value='system'}{${x}('id')}
  ```

  This technique assigns a variable to indirectly call functions, evading naive blacklist filters.

- **Steps:**
  - Test payloads using alternate syntax or variable assignments.
  - Confirm if code execution is achievable despite input restrictions.

  The result is successfully achieving code execution even in filtered contexts.

## Tools

- **Burp Suite**
- **curl**