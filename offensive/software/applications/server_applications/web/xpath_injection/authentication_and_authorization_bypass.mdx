---
title: XPath Injection for Authentication Bypass
description: Explore how XPath injection can bypass authentication and authorization
  in web apps.
keywords:
- XPath injection
- authentication bypass
- authorization bypass
- privilege escalation
- web security
---

# Authentication and Authorization Bypass

## Context

In the world of web security, exploiting XPath injection vulnerabilities can be a strategic maneuver to bypass authentication and authorization mechanisms. This article aims to demonstrate how an attacker can exploit such vulnerabilities in web applications, effectively bypassing these critical security controls. You should already be familiar with XPath query structure and syntax, as well as web application authentication and authorization flows and general XPath injection techniques.

## Theory

### Authentication Logic Vulnerabilities in XPath Contexts

Authentication bypass via XPath occurs when an application uses unsanitized user input in XPath queries, making it vulnerable to crafted payloads that manipulate the query to always return true. This allows attackers to gain unauthorized access without providing valid credentials. A typical attack sequence involves submitting input that alters the query logic to match any user node, thereby granting access.

#### Attack Sequence
1. The application expects user credentials in the form of XPath queries.
2. The attacker submits a crafted input that manipulates the query logic.
3. The manipulated query evaluates to true, allowing unauthorized access.

### Authorization and Privilege Escalation via XPath Injection

Authorization bypass exploits rely on altering the XPath logic used to verify roles or permissions, enabling attackers to access restricted resources or escalate their privileges. Applications that leverage XPath for these checks can be subverted by injecting conditions that evaluate to true, impersonating privileged users or escalating roles via payloads designed to alter the query's logic.

#### Attack Sequence
1. The application checks user roles using XPath queries.
2. The attacker injects a payload targeting the role attribute.
3. The manipulated query evaluates to include unauthorized roles, escalating privileges.

### User Enumeration and Session Bypass via XPath

XPath injection can reveal valid usernames or session tokens by observing the application's responses to crafted queries. Through iterative payload injections, attackers can manipulate predicates to enumerate users or bypass session checks, leveraging differences in responses to distinguish valid from invalid users.

#### Attack Sequence
1. The attacker injects payloads designed to test for valid usernames.
2. The application's error messages or responses indicate valid usernames or user IDs.
3. The attacker collects this information for further exploitation.

## Practice

### Bypassing Login Authentication with Always-True XPath Injection

To bypass login authentication using an always-true XPath injection:

- **Payload:** 
  ```http
  ' or '1'='1
  ```
  This payload injects an always-true condition into the username or password field, causing the application to grant access.
  
- **Command:**
  ```bash
  curl -X POST -d "username=' or '1'='1&password=irrelevant" http://target-app/login
  ```
  This command sends the payload to the login endpoint. The expected outcome is gaining access without valid credentials.

### Privilege Escalation by Injecting Admin Role in XPath Query

For escalating privileges by injecting an admin role:

- **Payload:** 
  ```http
  ' or role='admin' or '1'='1
  ```
  This command attempts to authenticate as an admin user, resulting in elevated privileges.

### User Enumeration via XPath Error Responses

To perform user enumeration:

- **Payload:** 
  ```http
  admin' or '1'='2
  ```
  Injects a payload to test for valid usernames.

- **Command:**
  ```bash
  curl -X POST -d "username=admin' or '1'='2&password=foo" http://target-app/login
  ```
  This approach relies on observing differences in error messages or responses to enumerate valid usernames or user IDs.

### Authorization Matrix Bypass via XPath Predicate Manipulation

To bypass authorization checks:

- **Payload:** 
  ```http
  ' or '1'='1
  ```
  Forces the predicate to always be true, bypassing authorization.

- **Command:**
  ```bash
  curl -b "session=attacker" http://target-app/restricted?resource=' or '1'='1
  ```
  This command accesses restricted resources by manipulating the resource parameter. The expected outcome is accessing resources without proper authorization.

## Tools

- **curl**
- **Burp Suite**
- **OWASP ZAP**

Each of these tools can be instrumental in crafting and sending malicious payloads, as well as observing application responses to assess vulnerabilities.