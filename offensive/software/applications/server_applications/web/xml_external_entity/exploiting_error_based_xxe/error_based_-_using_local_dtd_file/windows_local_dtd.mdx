---
title: 'Windows Local DTD: Exploiting XXE Vulnerabilities'
description: Learn how to exploit XXE vulnerabilities using local DTD files on Windows
  to access sensitive data like web.config.
keywords:
- Windows Local DTD
- XML External Entity
- XXE Vulnerability
- web.config disclosure
- DTD file abuse
- cim20.dtd
- Windows exploitation
- information disclosure
---

# Windows Local DTD

## Context

In this article, we will explore how to exploit error-based XML External Entity (XXE) vulnerabilities using local Document Type Definition (DTD) files in Windows environments. Our focus will be on leveraging these techniques to disclose sensitive files, such as `web.config`, which is critical for ASP.NET applications. It assumes familiarity with XML structure, DTD syntax, the Windows file system, and general XXE exploitation methods.

## Theory

### Windows DTD Files and Their Role in XXE

DTD, or Document Type Definition, is a set of rules for XML document structure that can be defined locally on Windows systems. Windows systems are equipped with default DTDs, like `cim20.dtd`, used by applications such as Windows Management Instrumentation (WMI). These local DTDs can be co-opted to expand entities maliciously, facilitating file disclosure during an XXE attack by leveraging errors returned from the parser.

### Abusing WBEM and cim20.dtd for File Disclosure

Windows Management (WBEM) commonly employs `cim20.dtd`, located at `C:\Windows\System32\wbem\cim20.dtd`. By referencing this local DTD in an XML payload, attackers can recursively load additional entities, triggering errors and subsequently leaking file contents through these errors.

### Targeting Sensitive Files: web.config

The `web.config` file is a configuration file for ASP.NET applications that can house critical information like database connection strings, application settings, and various secrets. Through local DTD abuse, attackers can craft XXE payloads that read and disclose the contents of `web.config` if error-based vulnerabilities are present in the application's XML processing features.

### Entity Expansion and Error-Based Disclosure

The exploitation process involves entity expansion, where the XXE payload forces the XML parser to process unintended files. Misconfigured error handling or deep recursion into the DTDs can cause the parser to throw errors, which may inadvertently leak fragments of the processed file content in error responses.

## Practice

### Error-Based XXE Using Local Windows DTD (cim20.dtd)

Here is a step-by-step guide on how to exploit local DTD files to disclose the `web.config` file contents:

- **Craft the XML Payload:**

    ```xml
    <?xml version="1.0"?>
    <!DOCTYPE root [
      <!ENTITY % dtd SYSTEM "file:///C:/Windows/System32/wbem/cim20.dtd"> 
      %dtd;
      <!ENTITY % file SYSTEM "file:///C:/inetpub/wwwroot/web.config"> 
      <!ENTITY % eval "<!ENTITY &#x25; error SYSTEM 'file:///%file;'>"> 
      %eval;
    ]>
    <root>&error;</root>
    ```

    This payload references the local `cim20.dtd` and aims to access `web.config`.

- **Submit the Payload:**

    Deliver the crafted XML to the vulnerable XML endpoint of the target application. This can typically be done with tools like `curl` or proxies such as Burp Suite.

- **Analyze the Error Response:**

    After payload submission, examine the application's error message for any leaked content from `web.config`. This output may reveal sensitive data, including configuration settings or connection strings.

### Outcome

Executing this technique successfully allows an attacker to access the sensitive contents of `web.config`, exploiting error-based XXE via local Windows DTD files.

## Tools

- **Burp Suite**
- **curl**