---
title: Exploiting DB2 for File Read/Write via SQL Injection
description: Learn how to exploit SQL Injection in IBM DB2 for file read/write operations.
keywords:
- DB2 SQL Injection
- file read
- file write
- ADMIN_CMD
- external script execution
- db2cmd
- server exploitation
---

# DB2 File Read/Write

## Context

Exploiting SQL Injection vulnerabilities in IBM's DB2 database can open up avenues for unauthorized file read and write operations. This guide demonstrates how attackers leverage misconfigurations and inadequate input validations in DB2's `ADMIN_CMD` to perform such operations. A foundational understanding of SQL Injection, file system permissions, and database privilege structures is assumed.

Note: The effectiveness of these techniques depends on several factors including DB2 version, operating system, user privileges, and database configuration. This guide assumes a relatively permissive environment for demonstration purposes.

## Theory

### ADMIN_CMD and Its Role in DB2

The `ADMIN_CMD` stored procedure is an administrative interface that permits execution of database-level commands such as reorganization, runstats, and file imports. While it does not natively support arbitrary shell commands, attackers may still abuse it by targeting adjacent procedures or poorly implemented wrappers in custom UDFs (User Defined Functions).

#### Misconceptions About `ADMIN_CMD`

Contrary to popular assumptions, `ADMIN_CMD` does not directly support Unix shell commands like `cat` or `echo`. Such commands may only execute through auxiliary means—like wrapped OS-level script calls, or vulnerable stored procedures linked via fenced-mode UDFs.

### File System Access via SQL Injection

By exploiting SQL Injection through `ADMIN_CMD`, attackers can gain access to a target's file system. This process involves injecting malicious SQL code that instructs the database server to execute file read or write commands—effectively treating the database as a gateway to the server's underlying file system. The attack's success hinges on leveraging the database's existing permissions to authenticate and execute these operations without direct access to the server.

### Understanding DB2 Permissions

In DB2, executing the `ADMIN_CMD` routine requires specific privileges. The following authorities are necessary to execute this routine:

EXECUTE privilege on the routine
DATAACCESS authority
DBADM authority
SQLADM authority

### Leveraging External Scripts for Exploitation

Beyond direct SQL injections, DB2 allows for external script execution. Attackers can exploit this by crafting SQL Injection payloads that execute external scripts on the database server, potentially enacting file reads, writes, or even system commands. This capability highlights the significant risk associated with allowing command execution features within DB2, particularly when misconfigured or insufficiently controlled.

## Practice

### File Read via SQL Injection

The following approach demonstrates reading a file using SQL Injection with `ADMIN_CMD`:

- **Inject the command using `IMPORT`**:
    ```sql
    CALL SYSPROC.ADMIN_CMD('IMPORT FROM /tmp/data.del OF DEL INSERT INTO sensitive_table');
    ```

    This command attempts to load data from a file into a DB2 table. If attackers can control the file path or target table, this could lead to sensitive file disclosure via indirect reads.

- **Alternate technique using `LOAD`**:
    ```sql
    CALL SYSPROC.ADMIN_CMD('LOAD FROM /tmp/shadow.del OF DEL INSERT INTO sensitive_table');
    ```
    This example uses the `LOAD` command to bring data from a file into a DB2 table. It can be faster than `IMPORT` and supports more complex data structures. As with `IMPORT`, success depends on control over the file path and permissions.

- **Trick using `MODIFIED BY HEX`**:
This technique tries to load non-DEL or binary files into a DB2 table by treating the input as hex-encoded content. It's useful when the file isn't structured as a traditional CSV or delimited format. The target table should be flexible enough to accept large, raw string data—for example:
    ```sql
      CREATE TABLE shadow_dump (col1 VARCHAR(32000));
    ```

    ```sql
    CALL SYSPROC.ADMIN_CMD('IMPORT FROM /etc/shadow OF DEL MODIFIED BY HEX INSERT INTO shadow_dump');
    ```
    This won't always parse cleanly, but it can help extract readable segments from otherwise unsupported file types.

- **Outcome**: Successful execution would result in indirect access to file contents through database tables.

### File Write via SQL Injection

To write data to a file using SQL Injection, the following is employed:

- **Inject the command**:
    ```sql
    CALL SYSPROC.ADMIN_CMD('EXPORT TO /tmp/export.del OF DEL SELECT * FROM sensitive_table');
    ```

    This exports sensitive table data to a file on disk, assuming the DB2 instance has necessary write permissions. It demonstrates a valid write scenario leveraging legitimate export functionality.

- **Outcome**: The ability to write arbitrary data to the server, which could lead to further code execution or data tampering.

## Tools

- **Burp Suite**
- **sqlmap**


