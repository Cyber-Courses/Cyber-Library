---
title: 'Network Scanning: Exploit SSRF for Internal Probing'
description: Explore network scanning via SSRF to identify open ports, services, and
  analyze firewall behavior internally.
keywords:
- network scanning
- SSRF exploitation
- internal port scanning
- firewall detection
- service fingerprinting
- response analysis
- banner grabbing
---

# Network Scanning

## Context

This article aims to empower offensive operators with the ability to conduct internal network scanning through SSRF vulnerabilities. These techniques allow identification of open ports and services within networks that aren't typically accessible from external entry points. Assumed knowledge includes TCP/IP protocols, understanding of network ports, crafting HTTP requests, and exploiting Server-Side Request Forgery (SSRF) vulnerabilities.

## Theory

### SSRF as a Network Scanning Vector

Leveraging Server-Side Request Forgery (SSRF) to initiate network requests enables attackers to probe internal network resources indirectly. An SSRF vulnerability allows an attacker to control the target of requests made from a compromised server. This control can be exploited to perform network scanning tasks, traditionally limited to within the network perimeter, by using the vulnerable server as a proxy to internal hosts and ports.

### Techniques for Internal Port Scanning via SSRF

By sending crafted SSRF payloads that target internal IP addresses and varying port numbers, the attacker can analyze response patterns to determine the open or closed status of ports. Here, the data flow can be visualized as follows:

```
Attacker → Vulnerable Web Application → Internal Resource → Response to Attacker
```

### Response Analysis and Service Fingerprinting

Through SSRF, differences in HTTP status codes, error messages, or response times can reveal the state of ports and potentially expose service banners. Crafting SSRF payloads creatively, such as using decimal, octal, or IPv6 notation, might be necessary to bypass input filters.

### Firewall and Network Topology Discovery

Firewalls can inadvertently disclose network behavior through connection timeouts, resets, or specific error codes. By conducting iterative probes of address ranges and interpreting the responses, an attacker can map reachable subnets, hosts, and services.

## Practice

### Manual SSRF-Based TCP Port Scanning

- **Step 1**: Identify SSRF injection points within the web application to locate where your input is utilized in server-side requests.
- **Step 2**: Craft and send an SSRF payload targeting an internal host and port, such as:

    ```http
    http://10.0.0.1:22/
    ```

- **Step 3**: Send this payload through the application’s vulnerable parameter and monitor the response for discrepancies in error messages or response times.
- **Step 4**: Repeat with different ports, such as:

    ```http
    http://10.0.0.1:80/
    ```

- **Step 5**: Document ports that create different responses—these may be open or filtered.

### Automated SSRF Port Scanning with SSRFmap

Utilize SSRFmap for automating the scanning of multiple ports efficiently.

- **Step 1**: Execute SSRFmap with a specified request file and targeted ports:

    ```bash
    ssrfmap -r request.txt -p url -m portscan --ports 21,22,80,443 --threads 5
    ```

- **Output Example**: Review the results to ascertain which ports are open:

    ```text
    [+] 10.0.0.1:22 open
    [+] 10.0.0.1:80 open
    [-] 10.0.0.1:21 closed
    ```

### Banner Grabbing via SSRF

- **Step 1**: Send an SSRF payload targeting an HTTP service to access potential banner information:

    ```http
    http://10.0.0.1:80/
    ```

- **Step 2**: Analyze the returned content for information revealing server type or version that might be included in HTTP headers or the body.

### Response Time Analysis for Firewall Detection

- **Step 1**: Deploy an SSRF payload to ports that are likely closed or filtered, such as:

    ```http
    http://10.0.0.1:81/
    ```

- **Step 2**: Utilize timing discrepancies from various port scans to deduce possible firewall rules and network segmentations, noting variations between expected open/closed port responses and processes significant for firewall filtering inferences.

## Tools

- **ssrfmap**
- **Burp Suite**