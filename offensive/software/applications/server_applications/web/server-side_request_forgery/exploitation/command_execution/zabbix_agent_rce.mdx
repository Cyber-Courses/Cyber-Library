---
title: Exploiting Zabbix Agent RCE via SSRF and Misconfiguration
description: Learn how to exploit Zabbix Agent Remote Code Execution through SSRF
  and configuration flaws for unauthorized command execution.
keywords:
- Zabbix Agent RCE
- Server-Side Request Forgery
- remote code execution
- EnableRemoteCommands
- Gopher protocol
- system.run
- security exploitation
- command execution
- SSRF vulnerability
---

# Zabbix Agent RCE

## Context

The Zabbix Agent RCE (Remote Code Execution) vulnerability can be exploited when an attacker leverages Server-Side Request Forgery (SSRF) combined with a misconfigured Zabbix Agent to execute arbitrary commands on the server. This article assumes a foundational understanding of SSRF, remote code execution techniques, and the Zabbix architecture.

## Theory

### Zabbix Agent Command Execution Mechanism

Zabbix is an open-source monitoring solution that uses agents to collect data from endpoints. The Zabbix Agent provides a specific feature, `system.run`, which allows for remote command execution. This powerful functionality is enabled when the agent's configuration file includes the setting `EnableRemoteCommands=1`. When this option is active, the Zabbix server can execute arbitrary operating system commands on the agent. 

This feature becomes a vulnerability if an attacker gains the ability to interact with the agent's listening service (typically on port 10050) through SSRF, enabling them to import commands without direct access.

### Abuse of SSRF to Reach Zabbix Agent

An SSRF vulnerability allows attackers to send requests from the vulnerable server to internal services that would otherwise be unreachable from outside the network. If the Zabbix Agent is accessible via SSRF, an attacker can send requests to this service, specifically targeting its capability to run system commands. SSRF payloads can be crafted to exploit Zabbix Agent's listening port, resulting in potential command execution.

### Gopher Protocol for SSRF Payload Delivery

Utilizing the Gopher protocol, attackers can send raw TCP payloads through the SSRF vulnerability, which bypasses any HTTP-only restrictions that might be in place. The Gopher protocol can format URLs to deliver precise command sequences to services like Zabbix Agent, which can interpret these commands as valid instructions due to their raw TCP nature.

### Command Execution and Timing Validation

To ascertain whether a command has been successfully executed on the Zabbix Agent, attackers often employ commands that create a noticeable delay, such as `sleep 2s`. This timing-based side channel can be observed by monitoring the response time of the SSRF exploitation attempt. If the Zabbix Agent runs the command and pauses, the increased response time is indicative of successful command execution.

## Practice

### SSRF to Zabbix Agent RCE via Gopher and system.run

1. **Craft a Gopher URL Payload:**
   - Use the Gopher protocol to create a payload that Zabbix Agent can process. The payload might look like this:
   
     ```http
     gopher://127.0.0.1:10050/_ZBXD\1\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0system.run[sleep 2s]\n
     ```

   - This payload instructs the Zabbix Agent to execute the `sleep 2s` command, introducing a delay.

2. **Inject the Payload into a Vulnerable Application:**
   - Locate a parameter within the SSRF-vulnerable web application where you can inject the Gopher payload.
   - The parameterized SSRF vulnerability will redirect your crafted request to the Zabbix Agent.

3. **Monitor the Response Time:**
   - Observe the time it takes for the application to respond to your request.
   - A significant delay indicates that the `sleep 2s` command was executed on the server, verifying remote command execution.

## Tools

- **Burp Suite**
- **curl**

This explanation provides a comprehensive guide to exploiting the Zabbix Agent RCE vulnerability via SSRF by illustrating the theoretical underpinnings and offering practical steps to execute an attack.