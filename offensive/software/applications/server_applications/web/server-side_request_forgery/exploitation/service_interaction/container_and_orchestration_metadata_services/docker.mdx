---
title: Exploiting Docker Metadata via SSRF Attacks
description: Learn how to exploit Docker metadata and API through SSRF attacks to
  compromise containers securely and effectively.
keywords:
- Docker
- SSRF
- Docker Engine API
- container metadata
- exploitation techniques
- Docker security
- metadata service
- container compromise
- API exposure
- unprotected endpoints
---

# Docker

## Context

In this guide, we will explore the exploitation of Docker metadata and the Docker Engine API through Server-Side Request Forgery (SSRF) to compromise containers. The guide assumes an understanding of key concepts such as containerization, basic orchestration, metadata service exploitation, and the mechanics of SSRF attacks. This knowledge is crucial for successfully navigating and exploiting vulnerabilities associated with Docker's exposed interfaces and metadata.

## Theory

### Docker Engine API Exposure

The Docker Engine API is a RESTful interface allowing for the management of Docker containers, images, and services. When the Docker API is exposed, either through TCP (commonly on port 2375) or a unix socket, it provides significant control over the Docker daemon. Without proper protection, such exposure can be exploited to gain unauthorized control. Unprotected Docker API endpoints are particularly vulnerable to SSRF attacks, as they may allow malicious actors to enumerate containers, create new ones, or manipulate existing containers without authentication.

### SSRF to Docker API Attack Surface

The attack surface for SSRF on Docker API is substantial, especially when the API is exposed. Attackers leverage SSRF vulnerabilities to send crafted HTTP requests to Docker API endpoints accessible via localhost or unix socket paths. A typical SSRF payload might target the endpoint `http://127.0.0.1:2375/v1.24/containers/json`, used to enumerate existing containers. The Docker API on TCP/2375, by default, lacks any form of authentication, further expanding the potential for exploitation.

### Container Metadata and Sensitive Endpoints

Docker containers maintain metadata that includes their configurations, environment variables, and mounted secrets. By exploiting SSRF vulnerabilities, attackers may access sensitive endpoints such as `/secrets` or `/service`, potentially exposing critical data such as credentials or secret keys stored within containers. Access to such data can have severe security implications.

## Practice

### Enumerate Docker Containers via SSRF

To enumerate Docker containers, you can utilize an SSRF vulnerability to send requests to the Docker API.

- **Payload:**

  ```http
  GET http://127.0.0.1:2375/v1.24/containers/json
  ```

  This SSRF payload will list the running Docker containers.

- **Review:** Examine the JSON response to identify container IDs, names, and images. This enumeration provides insights into the current container environment.

- **Outcome:** Successfully enumerating containers grants visibility into active containers and their metadata.

### Extract Secrets from Container Endpoints

To retrieve secrets from containers, you can target specific endpoints to download sensitive information.

- **Payload:**

  ```http
  GET http://127.0.0.1:2375/v1.24/containers/<container_id>/archive?path=/run/secrets
  ```

  Replace `<container_id>` with a valid container ID identified in the enumeration step.

- **Review:** Download and inspect the archive to discover sensitive files or embedded credentials within the container.

- **Outcome:** Gain access to secrets or credentials, which may provide further footholds into the system.

### Execute Commands in Containers via SSRF

Executing commands within containers can be performed by crafting API requests to the Docker API.

- **Payload:**

  ```http
  POST http://127.0.0.1:2375/v1.24/containers/<container_id>/exec
  {
      "AttachStdout": true,
      "AttachStderr": true,
      "Cmd": ["/bin/sh", "-c", "id"]
  }
  ```

  This payload will initiate command execution in the specified running container.

- **Review:** Capture and evaluate the command output for revealing information about user privileges or environment settings.

- **Outcome:** Successful execution results in command execution within a targeted Docker container, potentially leading to privilege escalation.

## Tools

- **curl**
- **Burp Suite**
- **Postman**

These tools are essential for crafting and delivering SSRF payloads, inspecting HTTP requests, and managing API interactions during the exploitation process.