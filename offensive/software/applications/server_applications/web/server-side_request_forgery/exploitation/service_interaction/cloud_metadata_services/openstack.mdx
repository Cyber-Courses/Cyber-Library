---
title: Exploiting OpenStack Metadata Service via SSRF
description: Learn to exploit OpenStack metadata service using SSRF for data extraction.
keywords:
- OpenStack
- SSRF
- metadata service
- cloud security
- instance metadata
- nova-api-metadata
- user-data
- cloud-init
- virtual machine
---

# OpenStack

## Context

The objective of this article is to demonstrate the exploitation of the OpenStack metadata service via Server-Side Request Forgery (SSRF) for credential and data extraction. This article assumes knowledge of the HTTP protocol, cloud service architecture, metadata service mechanism, and SSRF.

## Theory

### OpenStack Metadata Service Architecture

OpenStack, an open-source cloud computing platform, exposes instance metadata at the endpoint `http://169.254.169.254/openstack/latest/` for virtual machines (VMs). This metadata service is a critical component as it provides instance-specific data that include credentials and configuration details essential for the operation of VMs.

The metadata service relies on the `nova-api-metadata` component, which acts as a proxy, facilitating the relay of requests from the VMs to the metadata service endpoint. This architecture ensures that each VM can securely communicate with its corresponding metadata information for crucial configuration data.

### Attack Surface: SSRF to Metadata Service

Server-Side Request Forgery (SSRF) can be leveraged by attackers to make unauthorized requests to internal endpoints from which a vulnerable server has access. In the case of OpenStack's metadata service, an attacker can exploit SSRF vulnerabilities within a web application to access the metadata endpoint `http://169.254.169.254/openstack/latest/`.

The attack sequence follows these steps: The attacker identifies an SSRF injection point in a web application, which is then used to trigger requests. By crafting specific SSRF payloads, attackers can effectively exfiltrate metadata information that would otherwise be inaccessible.

### Sensitive Data in OpenStack Metadata

The OpenStack metadata service holds sensitive information. The `meta-data` endpoint contains instance details that could provide insights into the VM's environment, including instance ID, hostname, and network configuration. Meanwhile, the `user-data` endpoint often houses sensitive scripts, cloud-init configurations, SSH public keys, and sometimes even API credentials. This data, if improperly protected, can be a valuable target for attackers seeking to escalate their privileges or pivot within the network.

## Practice

### SSRF Exploitation of OpenStack Metadata Service

To exploit the OpenStack metadata service via SSRF, follow these practical steps:

- **Identify SSRF Injection Point**
  - Examine the target web application to locate parameters or features that request external URLs. This could be functionalities like PDF generation via remote URLs, image fetch features, or any interface that allows URL input.

- **Craft SSRF Payload**
  - Develop a payload to target the metadata service.
  ```http
  http://169.254.169.254/openstack/latest/meta-data
  ```

- **Execute Curl Command for Meta-Data**
  - Utilize the `curl` command to execute the request.
  ```bash
  curl -X GET 'http://vulnerable-app/resource?url=http://169.254.169.254/openstack/latest/meta-data'
  ```
  - This command aims to access the `meta-data`, which may reveal instance configuration details.

- **Execute Curl Command for User-Data**
  - Similarly, attempt to acess the `user-data`, which might contain more critical and sensitive data.
  ```bash
  curl -X GET 'http://vulnerable-app/resource?url=http://169.254.169.254/openstack/latest/user-data'
  ```

The successful execution of these commands can result in the retrieval of sensitive OpenStack metadata and user-data, revealing potential credentials and important configuration scripts.

## Tools

- **curl**
- **Burp Suite**