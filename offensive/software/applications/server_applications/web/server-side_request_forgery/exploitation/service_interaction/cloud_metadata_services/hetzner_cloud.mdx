---
title: Exploiting Hetzner Cloud Metadata via SSRF
description: Learn to exploit Hetzner Cloud metadata service with SSRF for sensitive
  data extraction.
keywords:
- Hetzner Cloud
- metadata service
- SSRF
- Server-Side Request Forgery
- cloud exploitation
- instance metadata
- sensitive data extraction
- cloud security
- web application vulnerability
---

# Hetzner Cloud

## Context

In this article, we will explore how to exploit the Hetzner Cloud metadata service using Server-Side Request Forgery (SSRF) to retrieve sensitive instance data. This will involve understanding the structure of Hetzner's metadata service and leveraging SSRF vulnerabilities to access internal cloud data. This guide assumes you have a foundational understanding of HTTP headers, web form structures, cloud service architecture, and cloud metadata service exploitation techniques, particularly SSRF.

## Theory

### Hetzner Cloud Metadata Service Structure

The Hetzner Cloud metadata service is accessible at a well-known non-routable IP address: `http://169.254.169.254/hetzner/v1/metadata`. This endpoint is designed to expose metadata related to the cloud instance it operates on. Crucially, this endpoint is intended to be accessible only from within the instance itself, allowing applications or scripts running on the instance to gather environment-specific configurations without exposing these details externally.

Applications with SSRF vulnerabilities become valuable targets, as these vulnerabilities can facilitate unauthorized queries to the metadata endpoint. Attackers aim to redirect the vulnerable application to request data from `http://169.254.169.254/hetzner/v1/metadata`, effectively proxying sensitive data to an external requester.

### Sensitive Data Available via Hetzner Metadata

The metadata returned by Hetzner's endpoint includes:

- **Hostname:** Represents the name of the instance.
- **Instance-id:** A unique identifier for the instance.
- **Public-ipv4:** The instance's public IP address.
- **Private-networks:** Lists private network configurations.
- **Availability-zone:** Indicates the instance's location within the data center.
- **Region:** Represents the broader geographical region of the data center.

These details, while primarily intended for configuration and automation scripts, can offer valuable insights for an attacker planning further actions or lateral movement.

### Attacker Mindset: SSRF to Metadata Extraction

An attacker leveraging SSRF to access metadata typically follows these steps:

1. Identify an SSRF vulnerability within a target application.
2. Craft a payload that routes a request to `http://169.254.169.254/hetzner/v1/metadata`.
3. Capture and analyze the returned metadata to expand the attack surface.

This attack presupposes that Hetzner trusts only internal, local processes to access its metadata endpoints, making robust SSRF auditing critical for security.

## Practice

### Extracting Hetzner Cloud Metadata via SSRF

Below is a step-by-step guide to exploiting SSRF to extract metadata from a Hetzner Cloud instance:

- **Identify SSRF Injection Point:**
  - Begin by locating a parameter within the target web application that allows for URL input. This can often be found in image URL fetches, API URL fetches, or redirect mechanisms.

- **Craft SSRF Payload:**

  ```http
  http://169.254.169.254/hetzner/v1/metadata
  ```

  - Utilize this crafted payload in the vulnerable parameter to redirect requests to Hetzner's metadata service.

- **Execute SSRF:**

  ```bash
  curl -X GET 'http://target-app/resource?url=http://169.254.169.254/hetzner/v1/metadata'
  ```

  - Use a tool like `curl` to simulate a web browser's request through the SSRF vulnerability.

- **Interpret Metadata Response:**

  ```json
  {
    "hostname": "example-vm",
    "instance-id": "123456",
    "public-ipv4": "203.0.113.10",
    "private-networks": ["10.0.0.5"],
    "availability-zone": "nbg1",
    "region": "eu-central"
  }
  ```

  - The above response contains the metadata including the hostname, instance-id, and network configurations, providing an attacker with specific environment details.

By executing these steps, an attacker can reveal sensitive information from Hetzner Cloud instances, thereby expanding their potential attack surface for further penetration or exploitation activities.

## Tools
- **curl**
- **Burp Suite**