---
title: 'ECS Task Metadata: Exploiting AWS with SSRF'
description: Learn how to exploit AWS ECS Task Metadata endpoints using SSRF for credential
  extraction and privilege escalation.
keywords:
- ECS Task Metadata
- AWS
- SSRF
- IAM Role
- Credential Extraction
- Privilege Escalation
- Metadata Endpoint
- Container Security
- AWS Security
---

# ECS Task Metadata

## Context

This article demonstrates how to exploit AWS ECS Task Metadata endpoints via Server-Side Request Forgery (SSRF) to extract container credentials for lateral movement or privilege escalation. This technique assumes that you have knowledge of cloud metadata services, ECS Task Metadata Service, IAM roles, and a fundamental understanding of SSRF.

## Theory

### ECS Task Metadata Endpoint Architecture

The ECS Task Metadata endpoint is a local HTTP service exposed to containers, providing runtime metadata and credentials. Typically, each ECS task is assigned a unique metadata endpoint located at `http://169.254.170.2`. Containers query this endpoint to obtain both task metadata and IAM role credentials, which are essential for executing operations within AWS using specified permissions.

### IAM Role Credential Exposure via Metadata

An attacker can exploit SSRF vulnerabilities in a web application within a container to access the metadata endpoint. By triggering SSRF requests to the credentials endpoint, attackers retrieve temporary AWS credentials linked to the ECS task's IAM role. AWS assumes that only the container hosting the service can access its assigned metadata endpoint, making this a critical trust assumption that can be exploited.

### ECS Metadata Endpoint Versions and Paths

ECS metadata endpoints exist in several versions, such as v2, v3, and v4, each offering varying paths and data granularity. A standard pattern for credential endpoints is `http://169.254.170.2/v2/credentials/<UUID>`. For a successful attack, SSRF payloads must target the appropriate version and the correct UUID path to extract the desired credentials.

## Practice

### SSRF to ECS Task Metadata Endpoint for Credential Extraction

1. **Identify SSRF injection point in the target containerized web application.**  
   Locate a parameter or header within the application that can trigger server-side HTTP requests.

2. **Craft SSRF payload to target the ECS metadata endpoint.**  
   Use the pattern `http://169.254.170.2/v2/credentials/<UUID>`. Replace `<UUID>` with the actual UUID if discoverable, or brute-force common patterns to find it.

3. **Execute the SSRF attack.**  
   Use tools like `curl` to send a request that triggers the SSRF vulnerability. For example:
   
   ```bash
   curl -s 'http://vulnerable-app.local/resource?url=http://169.254.170.2/v2/credentials/<UUID>'
   ```

4. **Retrieve AWS credentials.**  
   A successful response should resemble:
   
   ```json
   {
       "AccessKeyId": "ASIA...",
       "SecretAccessKey": "...",
       "Token": "...",
       "Expiration": "..."
   }
   ```

   These are temporary AWS credentials for the task's IAM role, potentially allowing further cloud actions.

## Tools

- **curl**
- **Burp Suite**
- **ffuf** 

This approach allows attackers with access to an SSRF vulnerability in AWS ECS environments to escalate privileges by obtaining credentials associated with the container's IAM role, leading to potential lateral movements or privilege escalation within AWS.