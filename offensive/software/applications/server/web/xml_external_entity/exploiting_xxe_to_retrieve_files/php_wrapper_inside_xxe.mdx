---
title: Exploiting PHP Wrapper in XXE Vulnerabilities
description: Learn how to exploit XXE with PHP wrappers to access and encode files
  securely.
keywords:
- PHP wrapper
- XXE exploitation
- php://filter
- base64 encoding
- XML external entity
- file retrieval
- cybersecurity
---

# PHP Wrapper Inside XXE

## Context

The objective of this guide is to demonstrate how attackers can exploit XML External Entity (XXE) vulnerabilities using PHP stream wrappers, specifically `php://filter`. This technique allows an attacker to retrieve and encode files by leveraging PHP-based backend systems. To engage with this content effectively, you should be familiar with XML parsing, PHP stream wrappers, file inclusion concepts, and the basics of XXE exploitation, including classic and base64-encoded XXE attacks.

## Theory

### PHP Stream Wrappers and Filters

PHP stream wrappers provide a standardized method to interact with various resource types, such as files, URLs, and filters, by treating them as streams. This versatile system allows file interactions and transformations to be executed seamlessly within a PHP environment.

The `php://filter` wrapper is particularly noteworthy because it allows the on-the-fly transformation of a file's contents. By using filters such as `convert.base64-encode`, an attacker can encode file contents in base64 format before they are output, which is especially useful when needing a binary-safe way to retrieve data.

### XXE Exploitation with php://filter

In an XXE attack utilizing `php://filter`, the attacker crafts an XML payload containing an external entity definition. This entity references `php://filter`, aiming to encode sensitive files like `/etc/passwd` in base64 format. The tactic is particularly effective if the PHP-based XML parser being targeted allows external entities, enabling attackers to bypass output encoding restrictions that might corrupt binary files.

Base64 encoding not only circumvents certain sanitization processes but also permits attackers to extract data without losing integrity, even if the data contains binary information.

### Threat Surface and Attacker Mindset

The main targets for this attack vector are applications that parse XML using PHP and allow for resolution of external entities. The process involves identifying initial file retrieval limitations and subsequently escalating to use `php://filter` for output that's encoded in base64, enhancing the attack's applicability and success rate.

## Practice

### Exploiting XXE with php://filter to Retrieve and Base64-Encode Sensitive Files

To effectively exploit an XXE vulnerability with the `php://filter` wrapper, follow these steps:

- **Craft a Malicious XML Payload:** 
  Create a payload defining an external entity that uses `php://filter` to base64-encode a targeted file:
  
  ```xml
  <!DOCTYPE foo [
  <!ENTITY xxe SYSTEM "php://filter/read=convert.base64-encode/resource=/etc/passwd">
  ]>
  <root>&xxe;</root>
  ```
  This payload causes the PHP XML parser to read `/etc/passwd` and encode its contents in base64.

- **Submit the Payload:**
  Send the crafted XML to the vulnerable XML processing endpoint of the target application. Use tools like Burp Suite or `curl` to facilitate this interaction.

- **Capture and Extract Response:**
  Once submitted, monitor the application's response and extract the base64-encoded file content from it. This response will contain the data from `/etc/passwd` encoded in base64.

- **Decode the File:**
  Having obtained the base64 data, decode the file locally to view its contents:

  ```bash
  echo '<base64-output>' | base64 -d
  ```
  Replace `<base64-output>` with the actual captured base64 data to retrieve the original file contents.

The expected outcome of this exploit is successful access and decoding of sensitive file information from the target server by employing XXE combined with `php://filter`.

## Tools

- **Burp Suite**
- **curl** 