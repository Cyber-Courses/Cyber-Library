# 22 - Pentesting SSH/SFTP


# üëâ¬†Overview

---

### üëÄ¬†What ?

Pentesting SSH/SFTP refers to the process of testing the security of Secure Shell (SSH) and Secure File Transfer Protocol (SFTP) services. SSH is a cryptographic network protocol used for secure data communication between two networked computers, while SFTP is a network protocol that provides file access, file transfer, and file management functionalities over any reliable data stream.


### üßê¬†Why ?

Pentesting SSH/SFTP is crucial as these services are widely used for secure communications and file transfers. If improperly configured or unpatched, they can become potential entry points for attackers. Understanding the security posture of these services is important to prevent unauthorized access, data breaches, and potential downtimes.


### ‚õèÔ∏è¬†How ?

Pentesting SSH/SFTP usually involves steps such as reconnaissance, where information about the target system is gathered; scanning, where tools like Nmap are used to identify open ports and services; gaining access, where vulnerabilities are exploited using various techniques; and maintaining access, where the tester tries to remain within the system undetected. Security controls are then evaluated based on their effectiveness in preventing or detecting the attack.


### ‚è≥¬†When ?

Pentesting SSH/SFTP started being a standard practice as organizations began to understand the importance of information security. It is typically performed periodically, or when significant changes are made to the network infrastructure.


# ‚öôÔ∏è¬†Technical Explanations

---

Pentesting SSH/SFTP is an in-depth task requiring a thorough understanding of certain protocols, cryptography, and network security. Secure Shell (SSH) is a cryptographic network protocol that operates on the application layer of the Open Systems Interconnection (OSI) model. It employs a client-server model for authentication and uses public key cryptography to verify the identity of the remote computer and vice versa.

The Secure File Transfer Protocol (SFTP) is a network protocol that uses SSH to provide secure file transfer capabilities. It ensures that data is securely transferred using a private and safe data stream. SFTP has a significant role in securing the data transmission against the common threats in an insecure network.

During the pentesting process, a variety of tools are used. Nmap, for instance, is a popular tool used for scanning. It aids in identifying open ports and services, which could potentially be exploited by attackers. Metasploit, on the other hand, is used for exploiting known vulnerabilities. It is a powerful tool that allows the simulation of real-world attacks on your network to identify security issues.

Hydra is another tool used for brute-forcing login credentials. It is one of the most effective password cracking tools and can perform rapid dictionary

An example of a pentesting process could be running a scan with Nmap, exploiting vulnerabilities with Metasploit, and brute-forcing login credentials with Hydra:

1. **Scanning with Nmap**: Nmap (Network Mapper) is used to discover hosts and services on a computer network. For example, to scan for open ports on a specific IP address, you would use the following command: `nmap -p 1-65535 -T4 -A -v [IP address]`. This command scans all ports, with an aggressive timing template, enabling OS detection, version detection, script scanning, and traceroute, and running it in verbose mode.
2. **Exploiting Vulnerabilities with Metasploit**: Once you've identified a potential vulnerability with Nmap, you can use Metasploit to exploit it. For example, if you've identified that a machine is running a vulnerable version of SSH, you might use an SSH exploit in Metasploit. First, you would start Metasploit with the command `msfconsole`. Then, you would search for available SSH exploits with `search ssh`. You would choose an appropriate exploit and set it as your exploit with the `use [exploit name]` command. Finally, you would set your target with `set RHOSTS [IP address]` and run the exploit with `run`.
3. **Brute-Forcing Login Credentials with Hydra**: If you can't exploit a vulnerability, you might try to brute-force a login with Hydra. For example, to brute force an SSH login, you might use the command `hydra -l root -P /usr/share/wordlists/rockyou.txt ssh://[IP address]`. This command attempts to brute force the root user's password using the popular "rockyou" wordlist.

Remember, these actions should only be performed in a legal and ethical manner, such as during a pentest with proper authorization.
