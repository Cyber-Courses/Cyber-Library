# Windows Access Tokens


# üëâ¬†Overview

---

### üëÄ¬†What ?

> Windows Access Tokens are security features in Microsoft Windows operating systems that contain information about a user's login session. They are used to authenticate and authorize the user for various system resources.
> 

### üßê¬†Why ?

> Understanding Windows Access Tokens is crucial because they are at the core of the Windows security model. They are used to validate the identity of the user and determine their access rights. Furthermore, manipulation of these tokens can lead to escalated privileges, which is a common technique used in cyber attacks.
> 

### ‚õèÔ∏è¬†How ?

> When a user logs into a Windows system, an Access Token is created by the Local Security Authority (LSA). This token is attached to the user's login session and is checked whenever the user requests access to a protected system resource. In a cybersecurity context, understanding how to interpret and manipulate Access Tokens can be invaluable for both defending against and performing penetration tests.
> 

### ‚è≥¬†When ?

> Windows Access Tokens have been used in the Windows OS since the introduction of Windows NT in 1993. Their usage became more widespread with the introduction of Active Directory in Windows 2000.
> 

# ‚öôÔ∏è¬†Technical Explanations

---

Access Tokens are essential components of the Windows security framework, providing detailed information about the user's identity, group memberships, and privileges. Generated by the Local Security Authority (LSA) during the login process, these tokens are attached to all processes and threads initiated by the user.

Each Access Token contains a variety of information, including the user's Security Identifier (SID), the SIDs for any groups the user is a part of, and a list of the user's privileges. Additionally, the token contains an owner SID, the primary group SID, and the default discretionary access control list (DACL).

When a user attempts to access a system resource, the Access Control List (ACL) of that resource is compared to the Access Token. The ACL is a list that defines who can access a particular resource and what operations they can perform. Each entry in an ACL is known as an Access Control Entry (ACE), and each ACE lists the permissions for a user or a group of users.

The Windows security subsystem checks whether the token has the necessary privileges to access the resource. If the token does, access is granted. If not, the system denies access.

This is where security concerns can arise - if a malicious actor can gain control of a token with elevated privileges (a process known as 'token stealing'), they can gain unauthorized access to system resources. In essence, the actor tricks the system into believing they have legitimate access. Therefore, understanding Access Tokens and how they can be manipulated is crucial for both cybersecurity defense and penetration testing efforts.

An example of how Access Tokens work in the context of Windows security can be seen when a user attempts to access a protected file on the system. Here's a step-by-step breakdown:

1. **User Login:** John logs into his Windows computer. During this login process, the Local Security Authority (LSA) generates an Access Token associated with John's user account. This token contains information about John's identity, group memberships, and privileges.
    
    ```
    net user John /add
    
    ```
    
2. **Token Information:** John's Access Token contains his Security Identifier (SID), the SIDs for any groups he is part of, and a list of his privileges. Additionally, the token contains an owner SID, the primary group SID, and the default discretionary access control list (DACL).
    
    ```
    whoami /all
    
    ```
    
    This command displays information about the current logged in user, which includes the user's SID, group memberships, and privileges.
    
3. **Resource Access:** John attempts to access a protected file on the system. The Access Control List (ACL) of that file is compared to John's Access Token.
    
    ```
    cacls C:\\protectedfile.txt
    
    ```
    
    This command displays the ACL for the file. Each entry in the ACL (known as an Access Control Entry, or ACE) lists the permissions for a user or group of users.
    
4. **Access Check:** The Windows security subsystem checks whether John's token has the necessary privileges to access the file. If the token does, access is granted. If not, access is denied.
    
    ```
    type C:\\protectedfile.txt
    
    ```
    
    This command attempts to read the file. If John's token has the necessary privileges, the command will output the contents of the file. If not, it will display an "Access is denied" error message.
    
5. **Security Concerns:** If a malicious actor somehow gains control of an Access Token with elevated privileges (a process known as 'token stealing'), they could gain unauthorized access to system resources. Therefore, understanding Access Tokens and how they can be manipulated is crucial for cybersecurity defense and penetration testing efforts.
