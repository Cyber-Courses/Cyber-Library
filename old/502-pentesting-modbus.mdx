# 502 - Pentesting Modbus


# üëâ¬†Overview

---

### üëÄ¬†What ?

Pentesting Modbus is a security testing practice that involves examining the Modbus industrial control system protocol for vulnerabilities that could be exploited by attackers.


### üßê¬†Why ?

The Modbus protocol is widely used in many industrial control systems. However, it lacks built-in security features, making it a prime target for cyber attacks. Penetration testing is critical to identify potential vulnerabilities and ensure the security of these systems.


### ‚õèÔ∏è¬†How ?

Modbus Pentesting involves several steps. First, you need to gather information about the target system. Then, scan the system for open ports and identify the Modbus devices. Once identified, you can perform various tests such as reading or writing coil values, or even injecting malicious packets, to evaluate the system's vulnerability.


### ‚è≥¬†When ?

The practice of Pentesting Modbus became crucial as industrial systems increasingly became targets of cyber attacks. The need for pentesting was further emphasized when researchers started to uncover various vulnerabilities in Modbus protocols.


# ‚öôÔ∏è¬†Technical Explanations

---

Modbus is a communication protocol utilized extensively in industrial control systems. It is designed on a simple client/server model. In this model, the client sends a request to the server device, which in turn responds. This straightforward design lends Modbus its robustness, making it a popular choice for industrial applications.

However, Modbus was developed during an era when most industrial systems were isolated, and security was not a major concern. As a result, Modbus lacks several crucial security features such as authentication, encryption, and confidentiality mechanisms. This lack of security features makes systems employing the Modbus protocol susceptible to a range of cyber attacks.

For instance, replay attacks, where an attacker captures valid data transactions and retransmits them to cause unauthorized effects, are possible due to the lack of authentication. Similarly, man-in-the-middle attacks, where an attacker intercepts and possibly alters the communication between two systems without their knowledge, can occur due to the lack of encryption. Furthermore, Denial of Service (DoS) attacks, which aim to make a system unavailable by overwhelming it with traffic, can also be executed against Modbus systems.

This is where Pentesting Modbus comes into play. Pentesting, or penetration testing, is a practice where cybersecurity professionals attempt to exploit the vulnerabilities in a system, in this case, a Modbus system, to understand its weaknesses. The purpose of this is not to cause harm, but to identify these vulnerabilities before an attacker does and rectify them, thereby enhancing the system's security.

Pentesting Modbus typically involves a series of steps. Firstly, information about the target system is gathered. Then, the system is scanned for open ports, and the Modbus devices are identified. Once these devices are identified, a variety of tests are conducted, such as reading or writing coil values or injecting malicious packets. These tests aim to evaluate the system's vulnerability to potential attacks and ultimately help to secure the systems better.

In summary, while Modbus is a robust protocol widely used in industry, its lack of built-in security features makes it vulnerable to cyber attacks. Consequently, Pentesting Modbus is a crucial practice to ensure the security of such systems.

Let's take an example of a pentesting process on a Modbus system using a tool called ModbusPal, a Java-based simulation tool for Modbus devices.

**Step 1: Setting up the ModbusPal simulator**
First of all, we need to set up a simulated Modbus device using ModbusPal. This is executed on a Linux terminal using the following command:

```
java -jar ModbusPal.jar

```

This command launches the ModbusPal tool.

**Step 2: Adding a Modbus slave**
The next step is to create a Modbus slave (a simulated Modbus device). To do this, we go to the ModbusPal interface and click `Add`, and then a new Modbus slave is added.

**Step 3: Setting up the register values**
We can then set up values for various registers within the Modbus slave. This can be done in the ModbusPal interface by selecting the specific slave and then setting the values.

**Step 4: Testing using a Modbus Master simulator**
We then use a Modbus Master simulator, such as QModMaster, to test the setup. We connect this to the Modbus slave by specifying the correct IP address and port number. Once connected, we can read or write coil values to the slave.

**Step 5: Injecting malicious packets**
The final step is the security testing phase. We can use a tool like Scapy to craft and send malicious Modbus packets. For instance, to create a TCP packet with a fake SYN, we can use the following command in Scapy:

```
packet = IP(dst="target IP")/TCP(flags="S")

```

We then send this packet using:

```
send(packet)

```

This packet can potentially cause disruptions to the Modbus system, hence revealing its vulnerabilities.

This example is purely educational and is a simplified version of a real Modbus pentesting scenario. It's crucial to remember that these techniques should only be used for legitimate security testing and not for harmful purposes.
