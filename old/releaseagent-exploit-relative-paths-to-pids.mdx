# release_agent exploit - Relative Paths to PIDs


# üëâ¬†Overview

---

### üëÄ¬†What ?

The Linux release_agent exploit - Relative Paths to PIDs is a vulnerability that can be exploited to escalate privileges on a Linux machine. The release_agent is a kernel parameter that can be set to specify a program to be executed when a cgroup (Control Group) becomes empty. The vulnerability lies in the fact that the path to the program is interpreted relatively to the PID of the process that causes the cgroup to become empty, allowing an attacker to run arbitrary programs with elevated privileges.


### üßê¬†Why ?

This vulnerability is significant as it can be exploited by a local attacker to gain root privileges on a Linux machine. Understanding this exploit is crucial for both system administrators for securing their systems and penetration testers for identifying potential attack vectors.


### ‚õèÔ∏è¬†How ?

To exploit this vulnerability, an attacker needs to create a cgroup, move their process into it, set the release_agent to the path of the desired program to be executed with elevated privileges, and cause the cgroup to become empty. This will cause the program specified by the release_agent to be executed with root privileges.


### ‚è≥¬†When ?

The exploitation of this vulnerability started to become prevalent in 2016, when it was discovered that the release_agent kernel parameter could be misused in this way. Despite patches being released to mitigate it, it remains a potent vector of attack in unpatched systems.


# ‚öôÔ∏è¬†Technical Explanations

---

The Linux release_agent exploit, also known as the Relative Paths to PIDs exploit, is a privilege escalation vulnerability. This exploit centers around the concept of cgroups (Control Groups) in Linux. Cgroups are a feature of the Linux kernel that enables the system to allocate resources like CPU time, system memory, network bandwidth, or various combinations of these resources among user-defined groups of processes.

When a cgroup becomes empty, which means all processes within it have finished executing, the Linux kernel executes a program specified by the release_agent parameter. This program is executed with root privileges, which means it has complete control over the system.

The crux of the exploit lies in how the path to the release_agent program is determined. Instead of being an absolute path, the path is interpreted in relation to the PID (Process ID) of the process that causes the cgroup to become empty. This vulnerability is what an attacker could exploit.

An attacker can create a cgroup and move their process into it. They can set the release_agent to the path of their desired program, which they want to run with elevated privileges. When the attacker causes the cgroup to become empty, the desired program will be executed. Because the program path is relative to the PID and not an absolute path, the attacker can manipulate the filesystem to have any program they choose to be executed with root privileges.

This vulnerability was discovered in 2016 and became a popular exploit, despite patches being released to mitigate it. Unpatched systems are still vulnerable to this attack, making it a critical area of understanding for system administrators and penetration testers.

Here is a simplified, educational example of how this exploit could be carried out:

1. Create a cgroup. This can be done using the cgcreate command:

```
cgcreate -g memory:/ExploitGroup

```

Here, we are creating a cgroup named ExploitGroup in the memory subsystem.

1. Move a process into the cgroup. This would typically be the attacker's shell process:

```
echo $$ /sys/fs/cgroup/memory/ExploitGroup/tasks

```

In this command, `$$` is a shell variable that holds the PID of the current shell.

1. Set the release_agent for the cgroup:

```
echo "/tmp/exploit" /sys/fs/cgroup/memory/release_agent

```

Here, "/tmp/exploit" is the path to the program we want to run with elevated privileges. It's set relative to the cgroup path.

1. Cause the cgroup to become empty. This could be done by simply exiting the shell:

```
exit

```

When the shell process exits, the cgroup becomes empty, triggering the execution of the release_agent.

In a real attack scenario, the "/tmp/exploit" program would be crafted by the attacker to carry out malicious actions with root privileges. However, this is a simplified example and shouldn't be attempted on a live system without understanding the implications.

Remember that this is a security vulnerability that should be patched on all systems and is provided here only for educational purposes.
