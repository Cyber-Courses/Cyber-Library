# 5985,5986 - Pentesting WinRM


# üëâ¬†Overview

---

### üëÄ¬†What ?

Pentesting WinRM (Windows Remote Management) is an activity that involves probing the WinRM service in Windows operating systems for vulnerabilities. The fundamental concept of pentesting WinRM involves understanding how this service works, its security settings, and how it can be exploited if not properly secured.


### üßê¬†Why ?

WinRM is a critical service in Windows environments, allowing administrators to remotely manage Windows servers and workstations. However, if not configured correctly, it can be a potential entry point for attackers. Therefore, understanding how to pentest WinRM is essential for cybersecurity professionals to identify and remediate vulnerabilities.


### ‚õèÔ∏è¬†How ?

Pentesting WinRM involves several steps. First, you need to identify if the WinRM service is running on the target system. Tools like Nmap can help in this task. Once identified, you can use a variety of techniques to exploit potential vulnerabilities. For instance, if WinRM is configured to allow unencrypted traffic, an attacker could potentially sniff sensitive data. Tools like Metasploit can be used to exploit known vulnerabilities.


### ‚è≥¬†When ?

Pentesting WinRM became particularly important with the increasing adoption of Windows servers in corporate environments. As Windows systems are common targets for attackers, the need for pentesting such services has been a continuous cybersecurity practice.


# ‚öôÔ∏è¬†Technical Explanations

---

Windows Remote Management (WinRM) is a service provided by Microsoft that allows IT administrators to remotely manage Windows servers and workstations. This service operates either over HTTP (on port 5985) or HTTPS (on port 5986), enabling the execution of commands or scripts on the target machine.

During a penetration test (pentest), the first step is to identify if the WinRM service is running on the target system. This can be achieved using various tools, such as Nmap. Following the identification, the tester should evaluate the WinRM configuration settings.

The configuration settings could reveal potential security gaps. For instance, if WinRM is set to allow unencrypted traffic, it can expose sensitive data to attackers who may be sniffing the network. Similarly, the use of weak credentials can also present a security risk, as they can be easily guessed or cracked.

After identifying potential vulnerabilities, the next step involves attempting to exploit these vulnerabilities. This could involve executing commands remotely, escalating user privileges on the machine, or exfiltrating sensitive data. Various hacking tools, such as Metasploit, can be utilized in this phase of the test.

Once the vulnerabilities have been exploited and the potential damage assessed, the findings are documented in a detailed report. This report typically includes a description of the identified vulnerabilities, the steps taken to exploit them, the potential impact, and recommendations for mitigating these vulnerabilities. It's crucial that this report is comprehensive and detailed, as it will guide the remediation process and help to strengthen the overall security posture of the Windows environment.

Let's take a detailed example of pentesting WinRM for educational purposes.

1. **Identifying the WinRM service:** The first step is to check if WinRM service is running on the target system. You can use Nmap, a network mapping tool for this.

```bash
nmap -p 5985,5986 <target-ip

```

This command will scan for open ports 5985 and 5986 (default WinRM ports) on the target system.

1. **Evaluate WinRM Configuration:** If WinRM is running, we need to check its configuration. For instance, we need to see if it allows unencrypted traffic. One tool to perform this task is the Windows PowerShell.

```bash
Invoke-Command -ComputerName <target-ip-ScriptBlock {Get-Item WSMan:\\localhost\\Service\\AllowUnencrypted}

```

This command checks if the WinRM service on the target machine is configured to allow unencrypted traffic.

1. **Attempt to Exploit Vulnerabilities:** If WinRM allows unencrypted traffic, an attacker could potentially sniff sensitive data. To demonstrate, let's use the tcpdump tool.

```bash
tcpdump -i eth0 'port 5985'

```

This command will start capturing unencrypted network traffic on port 5985.

1. **Exploit Known Vulnerabilities:** If there are known vulnerabilities, we can use tools like Metasploit to exploit them. For instance, if there's a known vulnerability with a certain version of WinRM, we can use a Metasploit module to exploit it.

```bash
msfconsole
use exploit/windows/winrm/<exploitname
set RHOSTS <target-ip
run

```

This sequence of commands will launch Metasploit, set the exploit module, set the target, and run the exploit.

1. **Document the Findings:** Once the vulnerabilities have been exploited, they need to be documented. This documentation should detail the vulnerability, how it was exploited, the potential impact, and recommendations for mitigation.

Remember, this is a demonstration for educational purposes and such activities should only be performed in a controlled, authorized environment.
