# 3702/UDP - Pentesting WS-Discovery


# üëâ¬†Overview

---

### üëÄ¬†What ?

WS-Discovery is a technical specification that defines a multicast discovery protocol to locate services on a local network. It operates over TCP and UDP port 3702. Pentesting WS-Discovery involves testing this service for vulnerabilities that could potentially be exploited.


### üßê¬†Why ?

WS-Discovery is widely used in various devices and systems such as printers, cameras, and other IoT devices. If not properly secured, it can be used as a launching pad for DDoS attacks or as a means to leak sensitive information. Thus, it is crucial for cybersecurity professionals to understand and test the security of this protocol to mitigate potential threats.


### ‚õèÔ∏è¬†How ?

To pentest WS-Discovery, start by scanning the network to identify devices that have this service enabled. This can be done using tools like Nmap. Once identified, send probe messages to the device and observe the responses. Look for any unusual or unexpected behaviour that may indicate a vulnerability. Tools like Wireshark can be used to analyze the traffic for any anomalies. Lastly, try to exploit the identified vulnerabilities, while ensuring not to cause any harm to the network or the device.


### ‚è≥¬†When ?

Pentesting WS-Discovery should be done during the initial stages of a penetration test, when you are conducting a network survey and identifying potential vulnerabilities. It should also be done whenever a new device is added to the network, or when there are changes to the existing network configuration.


# ‚öôÔ∏è¬†Technical Explanations

---

WS-Discovery is an essential service discovery protocol used on local networks. It uses SOAP (Simple Object Access Protocol) messages over UDP (User Datagram Protocol) to communicate. The protocol operates in two modes: Ad hoc and Managed. In Ad hoc mode, devices directly communicate with each other without any central directory. Conversely, in Managed mode, a central directory facilitates communication between devices.

One of the key potential vulnerabilities of WS-Discovery stems from the fact that its messages are unauthenticated. This could allow an attacker to spoof messages, posing as a legitimate device, or even launch a DDoS (Distributed Denial of Service) attack by flooding the network with traffic.

Another potential risk associated with WS-Discovery is information leakage. The messages sent by WS-Discovery can contain sensitive information about the device, such as its configuration and other specifics. If these messages are intercepted, it could provide an attacker with valuable information, potentially aiding in further attacks.

During a penetration test, these vulnerabilities should be a focal point. The first step is to identify devices on the network that are using WS-Discovery. This can be achieved using network scanning tools like Nmap. Once these devices are identified, the next step is to send probe messages and observe the responses. Any unexpected or unusual behavior could indicate a potential vulnerability. Network traffic should be analyzed using tools such as Wireshark to identify any anomalies or potential attack vectors. The final stage involves attempting to exploit any identified vulnerabilities, taking care not to harm the network or device.

Here's a step-by-step example of how one might conduct a penetration test on WS-Discovery:

**Step 1: Network Scanning**
Start by identifying devices on the network using WS-Discovery. You can use Nmap, a network scanning tool, to do this. The command might look something like this:

```bash
nmap -p 3702 --script=ws-discovery <target IP range

```

This command scans the specified IP range for devices with port 3702 (the port used by WS-Discovery) open. The `--script=ws-discovery` option uses Nmap's scripting engine to run a script specifically designed to detect WS-Discovery.

**Step 2: Send Probe Messages and Observe Responses**
Once the devices using WS-Discovery are identified, you can send probe messages to them. This can be done using a tool like `gSOAP`, which is a C/C++ software development toolkit for SOAP and REST XML Web services and generic C/C++ XML data bindings.

This step involves crafting a SOAP message that queries for WS-Discovery services and sending it to the target device. Any unusual or unexpected responses could indicate a potential vulnerability.

**Step 3: Analyzing Network Traffic**
Next, analyze the network traffic using a tool like Wireshark. This tool can capture and interactively browse the traffic running on a computer network. Look for any anomalies in the traffic or potential attack vectors. For example:

```bash
wireshark -i eth0 -k -Y "udp.port == 3702"

```

This command starts Wireshark on the `eth0` interface, automatically begins capturing packets (`-k`), and filters the display for traffic on UDP port 3702.

**Step 4: Attempting to Exploit Vulnerabilities**
The final stage involves trying to exploit any vulnerabilities you've identified. Be very careful during this stage not to cause harm to the network or device. This step would be highly specific to the vulnerabilities you've identified, so no general command can be provided. Always remember, the goal of pentesting is to help improve security, not to cause damage.
