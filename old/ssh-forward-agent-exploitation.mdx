# SSH Forward Agent exploitation


# üëâ¬†Overview

---

### üëÄ¬†What ?

SSH Agent Forwarding is a technique in which an SSH client allows an SSH server to use the credentials from the client side. The SSH agent (client side) holds the keys, and the SSH client (server side) uses these keys to authenticate on behalf of the user without having the user's keys. This feature is used to authenticate a chain of SSH connections without the necessity for password or public/private key exchanges.


### üßê¬†Why ?

Understanding SSH Agent Forwarding is crucial as it is a common feature used in managing remote servers. However, it can pose serious security risks if exploited, as an attacker who gains access to the server can also use the forwarded agent to authenticate on any other servers where the user has access. This is why it's important for our readers to understand how it works, its potential security implications, and how to secure it.


### ‚õèÔ∏è¬†How ?

To enable SSH Agent Forwarding, you can add the 'ForwardAgent yes' option in the ssh_config file or use the '-A' option when initiating an SSH connection. However, it's recommended to use it judiciously and only when necessary. It's safer to manually copy your keys to the server when needed or use 'scp' or 'rsync' for transferring files between servers.


### ‚è≥¬†When ?

SSH Agent Forwarding has been available since the introduction of OpenSSH, an open-source version of the Secure Shell (SSH) protocol, which was first released in 1999. Despite its potential security risks, it remains a feature in Linux systems due to its convenience in managing remote servers.


# ‚öôÔ∏è¬†Technical Explanations

---

SSH Agent Forwarding is a method where the SSH client allows an SSH server to use its credentials, specifically the client's private keys, to authenticate on the user's behalf. This functionality is often used to authenticate a chain of SSH connections without needing password or public/private key exchanges.

The process works as follows: The SSH client on the user's local machine runs an agent program in the background, which holds the user's decrypted private keys. When the user initiates an SSH connection to a remote server with agent forwarding enabled, the local client forwards the connection request, along with the user's public key, to the remote server.

The remote server then forwards the authentication request back to the agent on the local machine. The agent, holding the user's private key, signs the request. The signed request is then sent back to the server. If the server can verify the signature using the user's public key, it authorizes the connection. Crucially, the user's private key never leaves the local machine during this process.

However, SSH Agent Forwarding does have potential security risks. If an attacker gains access to the server, they could use the forwarded agent to authenticate on any other servers where the user has access. As such, it's recommended to use SSH Agent Forwarding judiciously and only when necessary. To enhance security, users can manually copy their keys to the server when needed or use 'scp' or 'rsync' for transferring files between servers.

SSH Agent Forwarding has been a feature since the introduction of OpenSSH, an open-source version of the Secure Shell (SSH) protocol, first released in 1999. Despite potential security risks, it's still widely used due to its convenience in managing remote servers.

Let's imagine a scenario where you are managing two remote Linux servers: `Server A` and `Server B`. You want to transfer files from `Server A` to `Server B` using SSH Agent Forwarding. Here's a step-by-step guide:

1. **Start the SSH agent in the background on your local machine.** You can do this by running the command: `eval "$(ssh-agent -s)"`. This starts the SSH agent program in the background of your local machine.
2. **Add your private key to the agent.** Use the command `ssh-add ~/.ssh/id_rsa`. This command adds your private key (in this case, `id_rsa`) to the agent.
3. **Establish an SSH connection to `Server A` with agent forwarding enabled.** The command for this would be: `ssh -A user@ServerA`. The `A` option enables agent forwarding.
4. **Check that the agent forwarding works.** Once logged into `Server A`, you can check if the agent forwarding works by running `ssh-add -L`. If it returns the public key that you added to the agent earlier, then the agent forwarding is working properly.
5. **Establish an SSH connection from `Server A` to `Server B`.** You can now SSH from `Server A` to `Server B` without needing to input the password or copy the private key to `Server A`. The command would be: `ssh user@ServerB`.
6. **Transfer files.** Once logged into `Server B`, you can now transfer files from `Server A` to `Server B` using `scp` or `rsync`.

Remember, while convenient, SSH Agent Forwarding can pose security risks. If `Server A` is compromised, an attacker could use the forwarded agent to authenticate on `Server B`. Use this feature judiciously and only when necessary.
