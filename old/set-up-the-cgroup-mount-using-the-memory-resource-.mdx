# Set up the cgroup mount using the memory resource cgroup controller


# üëâ¬†Overview

---

### üëÄ¬†What ?

Setting up the cgroup mount using the memory resource cgroup controller is a process of utilizing the Linux kernel feature, control groups (cgroups), to restrict and monitor the memory usage of a collection of processes. A cgroup controller, in this case, the memory resource controller, is responsible for defining how the cgroup's restrictions and monitoring will operate for the memory resource.


### üßê¬†Why ?

This setup is critical in resource management, especially in a shared system environment or in container-based virtualization. It allows system administrators to limit the amount of memory a process or a group of processes can use, preventing a single process from exhausting the system's memory. It also provides the ability to monitor the memory usage of each process or group of processes, which is essential for performance tuning and troubleshooting.


### ‚õèÔ∏è¬†How ?

To set up the cgroup mount using the memory resource cgroup controller, the following steps can be followed: 1. Create a mount point for the cgroup filesystem, 2. Mount the cgroup filesystem to the created mount point, 3. Create a subdirectory for the specific cgroup, 4. Add processes to the cgroup by writing their PIDs to the cgroup.procs file, 5. Set the memory limit by writing the desired limit to the memory.limit_in_bytes file. Remember that these steps require root privileges.


### ‚è≥¬†When ?

The usage of cgroups started with the Linux kernel 2.6.24, released in 2008. Over the years, the feature has been improved and now plays a crucial role in modern containerization technologies like Docker and Kubernetes.


# ‚öôÔ∏è¬†Technical Explanations

---

Control groups (cgroups) is a feature built into the Linux kernel that allows for the aggregation or partitioning of tasks (processes), including their future children, into hierarchical groups. These groups have specialized behavior, which offers a more granular level of system resource management.

In the context of memory management, using the cgroup memory controller can be particularly advantageous. This controller provides the ability to set limits on memory usage and measure memory usage across different processes. It can also implement out-of-memory (OOM) policies for groups of processes, which can prevent a single process from consuming too much memory and negatively impacting system performance.

When a cgroup is mounted with the memory controller, several files are created within the directory. These include files such as memory.limit_in_bytes, memory.usage_in_bytes, and memory.max_usage_in_bytes. These files play a critical role in the control and monitoring of memory usage for the cgroup.

The memory.limit_in_bytes file allows you to set a limit on the maximum memory usage of the cgroup. The memory.usage_in_bytes file provides real-time information on the memory usage of the cgroup. Lastly, the memory.max_usage_in_bytes file records the maximum memory usage observed for the cgroup.

This kind of setup is essential for resource management, especially in environments with shared systems or container-based virtualization. It provides system administrators with the ability to limit the amount of memory a process or a group of processes can use, which can prevent a single process from exhausting the system's memory. Additionally, it allows for monitoring the memory usage of each process or group of processes, which is vital for performance tuning and troubleshooting.

Overall, the use of cgroups and the memory resource cgroup controller offers a powerful tool for managing and monitoring system resources effectively.

Here's an example of how to set up a cgroup with the memory controller on a Linux system.

1. **Create a mount point for the cgroup filesystem:**
    
    First, you need to create a directory where the cgroup filesystem will be mounted. The directory can be named anything you want, but for this example, we'll call it `my_cgroup`.
    
    Command: `mkdir /my_cgroup`
    
2. **Mount the cgroup filesystem:**
    
    Next, you need to mount the cgroup filesystem to the directory you just created. The type of filesystem is `cgroup`, and for the options, you specify the `memory` controller.
    
    Command: `mount -t cgroup -o memory my_cgroup /my_cgroup`
    
3. **Create a subdirectory for the specific cgroup:**
    
    Within the mount point, you create a subdirectory for the specific cgroup. For this example, we'll create a cgroup called `test`.
    
    Command: `mkdir /my_cgroup/test`
    
4. **Add processes to the cgroup:**
    
    After creating the cgroup, you can add processes to it by writing their Process IDs (PIDs) to the `cgroup.procs` file in the cgroup's directory. For instance, if you want to add the current shell process to the cgroup, you would write the PID of the shell (`$$`) to `cgroup.procs`.
    
    Command: `echo $$ /my_cgroup/test/cgroup.procs`
    
5. **Set the memory limit:**
    
    Finally, you can set the memory limit for the cgroup by writing the desired limit to the `memory.limit_in_bytes` file in the cgroup's directory. The limit is specified in bytes. For example, to limit the memory usage to 500MB, you would write `500M` to the `memory.limit_in_bytes` file.
    
    Command: `echo 500M /my_cgroup/test/memory.limit_in_bytes`
    

Remember, all these steps require root privileges, so you would either need to be logged in as the root user or use `sudo` before each command.
